/* TreSensa Game Services, TGS-SDK, Version 0.3.32 */
/* Copyright (c) 2014 TreSensa, Inc. All Rights Reserved. */
function extend(a, b) {
    var c = a.prototype,
        d = function() {};
    d.prototype = b.prototype, a.prototype = new d, a.prototype.constructor = a, a.superclass = b.prototype, b.prototype.constructor === Object.prototype.constructor && (b.prototype.constructor = b);
    for (var e in c) c.hasOwnProperty(e) && (a.prototype[e] = c[e])
}

function getQueryString() {
    for (var a, b = {}, c = location.search.substring(1), d = /([^&=]+)=([^&]*)/g; a = d.exec(c);) b[decodeURIComponent(a[1])] = decodeURIComponent(a[2]);
    return b
}

function getDistributionPartner() {
    if ("undefined" == typeof CordovaConfig) {
        var a = getQueryString().dst;
        return "string" == typeof a ? a : null
    }
    return "string" == typeof CordovaConfig.DST_ID ? CordovaConfig.DST_ID : null
}

function loadScript(a, b) {
    var c = document.getElementsByTagName("head")[0],
        d = document.createElement("script");
    d.type = "text/javascript", d.src = a, d.onreadystatechange = b, d.onload = b, c.appendChild(d)
}
"document" in self && !("classList" in document.createElement("_") && "classList" in document.createElementNS("http://www.w3.org/2000/svg", "svg")) && ! function(a) {
    "use strict";
    if ("Element" in a) {
        var b = "classList",
            c = "prototype",
            d = a.Element[c],
            e = Object,
            f = String[c].trim || function() {
                return this.replace(/^\s+|\s+$/g, "")
            },
            g = Array[c].indexOf || function(a) {
                for (var b = 0, c = this.length; c > b; b++)
                    if (b in this && this[b] === a) return b;
                return -1
            },
            h = function(a, b) {
                this.name = a, this.code = DOMException[a], this.message = b
            },
            i = function(a, b) {
                if ("" === b) throw new h("SYNTAX_ERR", "An invalid or illegal string was specified");
                if (/\s/.test(b)) throw new h("INVALID_CHARACTER_ERR", "String contains an invalid character");
                return g.call(a, b)
            },
            j = function(a) {
                for (var b = f.call(a.getAttribute("class") || ""), c = b ? b.split(/\s+/) : [], d = 0, e = c.length; e > d; d++) this.push(c[d]);
                this._updateClassName = function() {
                    a.setAttribute("class", this.toString())
                }
            },
            k = j[c] = [],
            l = function() {
                return new j(this)
            };
        if (h[c] = Error[c], k.item = function(a) {
            return this[a] || null
        }, k.contains = function(a) {
            return a += "", -1 !== i(this, a)
        }, k.add = function() {
            var a, b = arguments,
                c = 0,
                d = b.length,
                e = !1;
            do a = b[c] + "", -1 === i(this, a) && (this.push(a), e = !0); while (++c < d);
            e && this._updateClassName()
        }, k.remove = function() {
            var a, b = arguments,
                c = 0,
                d = b.length,
                e = !1;
            do {
                a = b[c] + "";
                var f = i(this, a); - 1 !== f && (this.splice(f, 1), e = !0)
            } while (++c < d);
            e && this._updateClassName()
        }, k.toggle = function(a, b) {
            a += "";
            var c = this.contains(a),
                d = c ? b !== !0 && "remove" : b !== !1 && "add";
            return d && this[d](a), !c
        }, k.toString = function() {
            return this.join(" ")
        }, e.defineProperty) {
            var m = {
                get: l,
                enumerable: !0,
                configurable: !0
            };
            try {
                e.defineProperty(d, b, m)
            } catch (n) {
                -2146823252 === n.number && (m.enumerable = !1, e.defineProperty(d, b, m))
            }
        } else e[c].__defineGetter__ && d.__defineGetter__(b, l)
    }
}(self);
var CryptoJS = CryptoJS || function(a, b) {
    var c = {},
        d = c.lib = {},
        e = function() {},
        f = d.Base = {
            extend: function(a) {
                e.prototype = this;
                var b = new e;
                return a && b.mixIn(a), b.hasOwnProperty("init") || (b.init = function() {
                    b.$super.init.apply(this, arguments)
                }), b.init.prototype = b, b.$super = this, b
            },
            create: function() {
                var a = this.extend();
                return a.init.apply(a, arguments), a
            },
            init: function() {},
            mixIn: function(a) {
                for (var b in a) a.hasOwnProperty(b) && (this[b] = a[b]);
                a.hasOwnProperty("toString") && (this.toString = a.toString)
            },
            clone: function() {
                return this.init.prototype.extend(this)
            }
        },
        g = d.WordArray = f.extend({
            init: function(a, c) {
                a = this.words = a || [], this.sigBytes = c != b ? c : 4 * a.length
            },
            toString: function(a) {
                return (a || i).stringify(this)
            },
            concat: function(a) {
                var b = this.words,
                    c = a.words,
                    d = this.sigBytes;
                if (a = a.sigBytes, this.clamp(), d % 4)
                    for (var e = 0; a > e; e++) b[d + e >>> 2] |= (c[e >>> 2] >>> 24 - 8 * (e % 4) & 255) << 24 - 8 * ((d + e) % 4);
                else if (65535 < c.length)
                    for (e = 0; a > e; e += 4) b[d + e >>> 2] = c[e >>> 2];
                else b.push.apply(b, c);
                return this.sigBytes += a, this
            },
            clamp: function() {
                var b = this.words,
                    c = this.sigBytes;
                b[c >>> 2] &= 4294967295 << 32 - 8 * (c % 4), b.length = a.ceil(c / 4)
            },
            clone: function() {
                var a = f.clone.call(this);
                return a.words = this.words.slice(0), a
            },
            random: function(b) {
                for (var c = [], d = 0; b > d; d += 4) c.push(4294967296 * a.random() | 0);
                return new g.init(c, b)
            }
        }),
        h = c.enc = {},
        i = h.Hex = {
            stringify: function(a) {
                var b = a.words;
                a = a.sigBytes;
                for (var c = [], d = 0; a > d; d++) {
                    var e = b[d >>> 2] >>> 24 - 8 * (d % 4) & 255;
                    c.push((e >>> 4).toString(16)), c.push((15 & e).toString(16))
                }
                return c.join("")
            },
            parse: function(a) {
                for (var b = a.length, c = [], d = 0; b > d; d += 2) c[d >>> 3] |= parseInt(a.substr(d, 2), 16) << 24 - 4 * (d % 8);
                return new g.init(c, b / 2)
            }
        },
        j = h.Latin1 = {
            stringify: function(a) {
                var b = a.words;
                a = a.sigBytes;
                for (var c = [], d = 0; a > d; d++) c.push(String.fromCharCode(b[d >>> 2] >>> 24 - 8 * (d % 4) & 255));
                return c.join("")
            },
            parse: function(a) {
                for (var b = a.length, c = [], d = 0; b > d; d++) c[d >>> 2] |= (255 & a.charCodeAt(d)) << 24 - 8 * (d % 4);
                return new g.init(c, b)
            }
        },
        k = h.Utf8 = {
            stringify: function(a) {
                try {
                    return decodeURIComponent(escape(j.stringify(a)))
                } catch (b) {
                    throw Error("Malformed UTF-8 data")
                }
            },
            parse: function(a) {
                return j.parse(unescape(encodeURIComponent(a)))
            }
        },
        l = d.BufferedBlockAlgorithm = f.extend({
            reset: function() {
                this._data = new g.init, this._nDataBytes = 0
            },
            _append: function(a) {
                "string" == typeof a && (a = k.parse(a)), this._data.concat(a), this._nDataBytes += a.sigBytes
            },
            _process: function(b) {
                var c = this._data,
                    d = c.words,
                    e = c.sigBytes,
                    f = this.blockSize,
                    h = e / (4 * f),
                    h = b ? a.ceil(h) : a.max((0 | h) - this._minBufferSize, 0);
                if (b = h * f, e = a.min(4 * b, e), b) {
                    for (var i = 0; b > i; i += f) this._doProcessBlock(d, i);
                    i = d.splice(0, b), c.sigBytes -= e
                }
                return new g.init(i, e)
            },
            clone: function() {
                var a = f.clone.call(this);
                return a._data = this._data.clone(), a
            },
            _minBufferSize: 0
        });
    d.Hasher = l.extend({
        cfg: f.extend(),
        init: function(a) {
            this.cfg = this.cfg.extend(a), this.reset()
        },
        reset: function() {
            l.reset.call(this), this._doReset()
        },
        update: function(a) {
            return this._append(a), this._process(), this
        },
        finalize: function(a) {
            return a && this._append(a), this._doFinalize()
        },
        blockSize: 16,
        _createHelper: function(a) {
            return function(b, c) {
                return new a.init(c).finalize(b)
            }
        },
        _createHmacHelper: function(a) {
            return function(b, c) {
                return new m.HMAC.init(a, c).finalize(b)
            }
        }
    });
    var m = c.algo = {};
    return c
}(Math);
! function(a) {
    function b(a, b, c, d, e, f, g) {
        return a = a + (b & c | ~b & d) + e + g, (a << f | a >>> 32 - f) + b
    }

    function c(a, b, c, d, e, f, g) {
        return a = a + (b & d | c & ~d) + e + g, (a << f | a >>> 32 - f) + b
    }

    function d(a, b, c, d, e, f, g) {
        return a = a + (b ^ c ^ d) + e + g, (a << f | a >>> 32 - f) + b
    }

    function e(a, b, c, d, e, f, g) {
        return a = a + (c ^ (b | ~d)) + e + g, (a << f | a >>> 32 - f) + b
    }
    for (var f = CryptoJS, g = f.lib, h = g.WordArray, i = g.Hasher, g = f.algo, j = [], k = 0; 64 > k; k++) j[k] = 4294967296 * a.abs(a.sin(k + 1)) | 0;
    g = g.MD5 = i.extend({
        _doReset: function() {
            this._hash = new h.init([1732584193, 4023233417, 2562383102, 271733878])
        },
        _doProcessBlock: function(a, f) {
            for (var g = 0; 16 > g; g++) {
                var h = f + g,
                    i = a[h];
                a[h] = 16711935 & (i << 8 | i >>> 24) | 4278255360 & (i << 24 | i >>> 8)
            }
            var g = this._hash.words,
                h = a[f + 0],
                i = a[f + 1],
                k = a[f + 2],
                l = a[f + 3],
                m = a[f + 4],
                n = a[f + 5],
                o = a[f + 6],
                p = a[f + 7],
                q = a[f + 8],
                r = a[f + 9],
                s = a[f + 10],
                t = a[f + 11],
                u = a[f + 12],
                v = a[f + 13],
                w = a[f + 14],
                x = a[f + 15],
                y = g[0],
                z = g[1],
                A = g[2],
                B = g[3],
                y = b(y, z, A, B, h, 7, j[0]),
                B = b(B, y, z, A, i, 12, j[1]),
                A = b(A, B, y, z, k, 17, j[2]),
                z = b(z, A, B, y, l, 22, j[3]),
                y = b(y, z, A, B, m, 7, j[4]),
                B = b(B, y, z, A, n, 12, j[5]),
                A = b(A, B, y, z, o, 17, j[6]),
                z = b(z, A, B, y, p, 22, j[7]),
                y = b(y, z, A, B, q, 7, j[8]),
                B = b(B, y, z, A, r, 12, j[9]),
                A = b(A, B, y, z, s, 17, j[10]),
                z = b(z, A, B, y, t, 22, j[11]),
                y = b(y, z, A, B, u, 7, j[12]),
                B = b(B, y, z, A, v, 12, j[13]),
                A = b(A, B, y, z, w, 17, j[14]),
                z = b(z, A, B, y, x, 22, j[15]),
                y = c(y, z, A, B, i, 5, j[16]),
                B = c(B, y, z, A, o, 9, j[17]),
                A = c(A, B, y, z, t, 14, j[18]),
                z = c(z, A, B, y, h, 20, j[19]),
                y = c(y, z, A, B, n, 5, j[20]),
                B = c(B, y, z, A, s, 9, j[21]),
                A = c(A, B, y, z, x, 14, j[22]),
                z = c(z, A, B, y, m, 20, j[23]),
                y = c(y, z, A, B, r, 5, j[24]),
                B = c(B, y, z, A, w, 9, j[25]),
                A = c(A, B, y, z, l, 14, j[26]),
                z = c(z, A, B, y, q, 20, j[27]),
                y = c(y, z, A, B, v, 5, j[28]),
                B = c(B, y, z, A, k, 9, j[29]),
                A = c(A, B, y, z, p, 14, j[30]),
                z = c(z, A, B, y, u, 20, j[31]),
                y = d(y, z, A, B, n, 4, j[32]),
                B = d(B, y, z, A, q, 11, j[33]),
                A = d(A, B, y, z, t, 16, j[34]),
                z = d(z, A, B, y, w, 23, j[35]),
                y = d(y, z, A, B, i, 4, j[36]),
                B = d(B, y, z, A, m, 11, j[37]),
                A = d(A, B, y, z, p, 16, j[38]),
                z = d(z, A, B, y, s, 23, j[39]),
                y = d(y, z, A, B, v, 4, j[40]),
                B = d(B, y, z, A, h, 11, j[41]),
                A = d(A, B, y, z, l, 16, j[42]),
                z = d(z, A, B, y, o, 23, j[43]),
                y = d(y, z, A, B, r, 4, j[44]),
                B = d(B, y, z, A, u, 11, j[45]),
                A = d(A, B, y, z, x, 16, j[46]),
                z = d(z, A, B, y, k, 23, j[47]),
                y = e(y, z, A, B, h, 6, j[48]),
                B = e(B, y, z, A, p, 10, j[49]),
                A = e(A, B, y, z, w, 15, j[50]),
                z = e(z, A, B, y, n, 21, j[51]),
                y = e(y, z, A, B, u, 6, j[52]),
                B = e(B, y, z, A, l, 10, j[53]),
                A = e(A, B, y, z, s, 15, j[54]),
                z = e(z, A, B, y, i, 21, j[55]),
                y = e(y, z, A, B, q, 6, j[56]),
                B = e(B, y, z, A, x, 10, j[57]),
                A = e(A, B, y, z, o, 15, j[58]),
                z = e(z, A, B, y, v, 21, j[59]),
                y = e(y, z, A, B, m, 6, j[60]),
                B = e(B, y, z, A, t, 10, j[61]),
                A = e(A, B, y, z, k, 15, j[62]),
                z = e(z, A, B, y, r, 21, j[63]);
            g[0] = g[0] + y | 0, g[1] = g[1] + z | 0, g[2] = g[2] + A | 0, g[3] = g[3] + B | 0
        },
        _doFinalize: function() {
            var b = this._data,
                c = b.words,
                d = 8 * this._nDataBytes,
                e = 8 * b.sigBytes;
            c[e >>> 5] |= 128 << 24 - e % 32;
            var f = a.floor(d / 4294967296);
            for (c[(e + 64 >>> 9 << 4) + 15] = 16711935 & (f << 8 | f >>> 24) | 4278255360 & (f << 24 | f >>> 8), c[(e + 64 >>> 9 << 4) + 14] = 16711935 & (d << 8 | d >>> 24) | 4278255360 & (d << 24 | d >>> 8), b.sigBytes = 4 * (c.length + 1), this._process(), b = this._hash, c = b.words, d = 0; 4 > d; d++) e = c[d], c[d] = 16711935 & (e << 8 | e >>> 24) | 4278255360 & (e << 24 | e >>> 8);
            return b
        },
        clone: function() {
            var a = i.clone.call(this);
            return a._hash = this._hash.clone(), a
        }
    }), f.MD5 = i._createHelper(g), f.HmacMD5 = i._createHmacHelper(g)
}(Math);
var TGS = TGS || {},
    merge = function(a, b) {
        b = b || {}, a = a || {};
        for (var c in b) a[c] = b[c];
        return a
    };
Function.prototype.bind || (Function.prototype.bind = function(a) {
        if ("function" != typeof this) throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
        var b = Array.prototype.slice.call(arguments, 1),
            c = this,
            d = function() {},
            e = function() {
                return c.apply(this instanceof d && a ? this : a, b.concat(Array.prototype.slice.call(arguments)))
            };
        return d.prototype = this.prototype, e.prototype = new d, e
    }), Array.prototype.some || (Array.prototype.some = function(a) {
        "use strict";
        if (void 0 === this || null === this) throw new TypeError;
        var b = Object(this),
            c = b.length >>> 0;
        if ("function" != typeof a) throw new TypeError;
        for (var d = arguments.length >= 2 ? arguments[1] : void 0, e = 0; c > e; e++)
            if (e in b && a.call(d, b[e], e, b)) return !0;
        return !1
    }),
    function() {
        TGS.Utils = {
            isTGEGame: function() {
                return !(!window.TGE || !window.TGE.Game.GetInstance())
            },
            Func: {
                prop: function(a) {
                    return function(b) {
                        return b[a]
                    }
                }
            }
        }
    }(), TGS.PartnerBridge = function() {
        this._mIsReady = !1, this._mLoggedIn = !0, this._mUsername = null, this._mAvatarURL = null, this._mUserLocation = null, this._mUseUserInfoInSLB = !1, this._mFacebookServicesAllowed = !0, this._mFacebookLibLoaded = !1, this._mFacebookInitialized = !1, this._mFacebookAppID = null, this._mFacebookUserID = null, this._mFacebookAccessToken = null, this._mFacebookLoginRequiredCallback = null, this._mFacebookLoggedInCallback = null, this._mMoreGamesURL = null, this._mMoreGamesImage = TGS._IMAGES_LOCATION + "more_games.png", this._mMoreGamesTarget = window.self === window.top ? "_self" : "_blank", this._mMoreGamesText = " ", this._mSplashScreen = !1, this._mSplashTimer = 3, this._mSplashBackgroundColor = "#fff", this._mDisplayAdsEnabled = !0, this._mInterstitialAdsEnabled = !0, this._mPreloaderAdsEnabled = !1, this._mValueExchangeAdsEnabled = !0, this._mShowBookmarkPrompt = !1, this.freeIAP = !1, this.freeIAPTitle = "Woo-hoo!", this.freeIAPMessage = "You've just unlocked this item for free!", this.autoUnlockNonConsumables = !1, this.offerValueExchange = !1, this.valueExchangeMessage = "Woo-hoo! You just unlocked this item for free, thanks to the following ad from our sponsors:", this.onAdapterReady = null, this.onUserInfoAvailable = null
    }, TGS.PartnerBridge.prototype = {
        supportsMicrotransactions: function() {
            return !1
        },
        allowsMicrotransactions: function() {
            return this.supportsMicrotransactions()
        },
        supportsDatastore: function() {
            return TGS.DataStore._sSaveToLocalStorage || TGS.DataStore._sSaveToTGSServer
        },
        autoLogin: function() {
            return !0
        },
        supportsLogout: function() {
            return !0
        },
        loginIcon: function() {
            return TGS._IMAGES_LOCATION + "test_login.png"
        },
        logoutIcon: function() {
            return TGS._IMAGES_LOCATION + "logout.png"
        },
        widgetLoginIcon: function() {
            return this.loginIcon()
        },
        widgetLogoutIcon: function() {
            return this.logoutIcon()
        },
        loggedIn: function() {
            return this._mLoggedIn
        },
        loginUser: function(a) {
            this.autoLogin() ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "loginUser: user is already logged in"), TGS._LoginSucceeded(a)) : (TGS.Debug.Log(TGS.Debug.LOG_ERROR, "this adapter does not do auto-login, but has not defined its own loginUser method"), TGS._LoginFailed(a))
        },
        logoutUser: function(a) {
            return TGS.Debug.Log(TGS.Debug.LOG_INFO, "logging out user..."), TGS.AutoLogin() ? (TGS.Debug.Log(TGS.Debug.LOG_ERROR, "logoutUser: user cannot be logged out on this partner"), void TGS._LoginFailed(a)) : (this._mLoggedIn = !1, TGS.localStorage.removeItem(TGS._sLSKeys.TGS_loggedin_user), TGS.localStorage.removeItem(TGS._sLSKeys.TGS_username), TGS.localStorage.removeItem(TGS._sLSKeys.TGS_avatar), TGS.localStorage.removeItem(TGS._sLSKeys.TGS_location), this._mUsername = this._mAvatarURL = this._mUserLocation = null, this.generateGuestUserID(), TGS.DataStore._sSaveToTGSServer = !1, TGS.DataStore.ClearLocalData(), void TGS._LoginSucceeded(a))
        },
        implementsLeaderboard: function() {
            return !1
        },
        showLeaderboard: function() {},
        leaderboardLabel: function(a) {
            return a ? "" : ""
        },
        submitScore: function() {},
        submitScoreAndShow: function() {},
        supportsChallenges: function() {
            return !1
        },
        challengeIcon: function() {
            return null
        },
        challenge: function(a) {
            FB.ui({
                show_error: !0,
                method: "apprequests",
                title: a.title,
                message: a.message
            }, function(a) {
                a && a.to ? TGS.Analytics._logChallengeEvent("request sent", {
                    request: a.request,
                    to: a.to.join(", ")
                }) : TGS.Analytics._logChallengeEvent("request cancelled")
            })
        },
        share: function(a, b) {
            var c = "scrollbars=yes,resizable=yes,toolbar=no,location=yes",
                d = 550,
                e = 420,
                f = screen.height,
                g = screen.width,
                h = Math.round(g / 2 - d / 2),
                i = 0;
            if (f > e && (i = Math.round(f / 2 - e / 2)), "twitter" == a) {
                var j = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(b.msg) + "&url=" + encodeURIComponent(b.url);
                TGS.OpenURL(j, "intent", c + ",width=" + d + ",height=" + e + ",left=" + h + ",top=" + i, !0)
            } else if ("fb" == a)
                if ("string" != typeof window.location.host || -1 === window.location.host.indexOf("tresensa.com")) {
                    var j = ["https://www.facebook.com/dialog/feed?", "app_id=", this._mFacebookAppID, "&display=popup&caption=", encodeURIComponent(b.msg), "&link=", encodeURIComponent(b.url), "&redirect_uri=", encodeURIComponent("http://tgs.tresensa.com/close .html")].join("");
                    TGS.OpenURL(j, "intent", c + ",width=" + d + ",height=" + e + ",left=" + h + ",top=" + i)
                } else FB.ui({
                    method: "feed",
                    caption: b.msg,
                    link: b.url
                }, function(a) {
                    console.log(a)
                })
        },
        getShareServices: function() {
            var a = [TGS.Social._services.twitter];
            return "undefined" != typeof FB && a.push(TGS.Social._services.fb), a
        },
        adsAllowed: function() {
            return !0
        },
        showMoreGames: function() {
            var a = TGS.MoreGamesURL();
            if ("string" == typeof a) {
                TGS.Analytics._logMoreGamesEvent(a);
                var b = this._mMoreGamesTarget;
                return TGS.Debug.Log(TGS.Debug.LOG_INFO, "directing to more games (target " + b + "): " + a), window.open(a, b), a
            }
            return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "more games URL is invalid"), "error"
        },
        costFactor: function() {
            return 10
        },
        priceAsFormattedString: function(a) {
            return "$" + (a * this.costFactor() / 100 - .01).toFixed(2)
        },
        formattedPriceForItem: function() {
            return "$" + (aPrice * this.costFactor() / 100 - .01).toFixed(2)
        },
        currencyIcon: function() {
            return null
        },
        paymentProviderName: function() {
            return TGS._sPartnerID
        },
        purchaseItem: function() {},
        restorePurchases: function() {},
        serverHandlesMicrotransactionResponse: function() {
            return !1
        },
        logTransactionBeforePartnerRequest: function() {
            return !0
        },
        purchaseComplete: function() {},
        gameWasLaunched: function() {},
        isReady: function() {
            return this._mIsReady
        },
        isFacebookReady: function() {
            return this._mFacebookInitialized
        },
        loggedIntoFacebook: function() {
            return this.isFacebookReady() && null !== this._mFacebookUserID
        },
        enablePartnerUI: function() {},
        masterInitialize: function() {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.masterInitialize called"), this._mFacebookServicesAllowed && ("undefined" != typeof FB ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "detected Facebook library..."), this.onFacebookLibraryLoaded()) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "loading Facebook library..."), head.js(("https:" === document.location.protocol ? "https:" : "http:") + "", this.onFacebookLibraryLoaded.bind(this)))), this.initialize()
        },
        initialize: function() {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.initialize called"), this._mIsReady = !0, null !== this.onAdapterReady && this.onAdapterReady.call()
        },
        onFacebookLibraryLoaded: function() {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "PartnerBridge.onFacebookLibraryLoaded called, Facebook library loaded successfully"), this._mFacebookLibLoaded = !0, this._mFacebookInitialized || this.initFacebook()
        },
        requiredPartnerProperties: function() {
            return ""
        },
        requestGameInfo: function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.requestGameInfo called");
            var b = this.requiredPartnerProperties();
            this._mFacebookServicesAllowed && (b += b.length > 0 ? "," : "", b += '"facebook_app_id"');
            var c = '{"game":"' + a + '","partner":"' + TGS._sPartnerID + '","keys":[' + b + "]}";
            TGS.SendMessage("partner_data", "get", c, TGS.onGamePartnerInfoReceived, TGS.onGamePartnerInfoError)
        },
        masterConnect: function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.masterConnect called"), this._mFacebookServicesAllowed && (this._mFacebookAppID = a.facebook_app_id, this._mFacebookLibLoaded && this._mFacebookAppID && "undefined" != typeof FB && this.initFacebook()), a.ga_tracking_id && (TGS._sPartnerBridge._GoogleAnalyticsId = a.ga_tracking_id), a.add_to_home && (TGS._sPartnerBridge._mShowBookmarkPrompt = !0), a.more_games_url && (TGS._sPartnerBridge._mMoreGamesURL = a.more_games_url), a.splash && (TGS._sPartnerBridge._mSplashScreen = !0, TGS._sPartnerBridge._mSplashBackgroundColor = a.splash.background_color, TGS._sPartnerBridge._mSplashTimer = a.splash.duration, TGS._sPartnerBridge._mSplashImage = a.splash.image_url), a.ads && (void 0 !== a.ads.display_ads && (TGS._sPartnerBridge._mDisplayAdsEnabled = a.ads.display_ads), void 0 !== a.ads.interstitial_ads && (TGS._sPartnerBridge._mInterstitialAdsEnabled = a.ads.interstitial_ads), void 0 !== a.ads.preloader_ads && (TGS._sPartnerBridge._mPreloaderAdsEnabled = a.ads.preloader_ads), void 0 !== a.ads.value_exchange && (TGS._sPartnerBridge._mValueExchangeAdsEnabled = a.ads.value_exchange_ads)), this.connect(a), TGS.Analytics._init(TGS._sConfig || {}), TGS._sUserID || TGS.Debug.Log(TGS.Debug.LOG_INFO, "waiting on user id from partner... (TGS.onUserInfoAvailable has not been fired)")
        },
        connect: function() {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.connect called"), this.getLoginStatus()
        },
        initFacebook: function() {
            if (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.initFacebook called"), !this._mFacebookInitialized) {
                if (!this._mFacebookAppID) return void(null !== TGS._sGamePartnerInfo && TGS.Debug.Log(TGS.Debug.LOG_ERROR, "cannot initialize Facebook without a Facebook app id (connection problem or the id was not defined in the TGS db)"));
                TGS.Debug.Log(TGS.Debug.LOG_INFO, "Calling FB.init, appId = " + this._mFacebookAppID), FB.init({
                    appId: this._mFacebookAppID,
                    channelUrl: "//channel.html",
                    status: !0,
                    cookie: !0,
                    xfbml: !0
                });
                var a = this;
                FB.Event.subscribe("auth.authResponseChange", function(b) {
                    TGS.Debug.Log(TGS.Debug.LOG_INFO, "the Facebook session status changed to " + b.status), a.onGetFBLoginStatus(b)
                }), this._mFacebookInitialized = !0
            }
        },
        loginToFacebook: function(a, b) {
            this._mFacebookLoginRequiredCallback = a, this._mFacebookLoggedInCallback = b, this._mFacebookInitialized || this.initFacebook(), TGS.Debug.Log(TGS.Debug.LOG_INFO, "calling FB.getLoginStatus..."), ("string" != typeof window.location.host || -1 === window.location.host.indexOf("tresensa.com")) && TGS.Debug.Log(TGS.Debug.LOG_WARNING, "FB.getLoginStatus will only work if the game is hosted on an approved domain (typically tresensa.com)"), FB.getLoginStatus(this.onGetFBLoginStatus.bind(this))
        },
        onGetFBLoginStatus: function(a) {
            "connected" === a.status ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "user is logged into Facebook and authorized the app"), FB.api("/me", function(a) {
                TGS.Analytics._updateUserData(a)
            }), this._mFacebookUserID = a.authResponse.userID, this._mFacebookAccessToken = a.authResponse.accessToken, null !== this._mFacebookLoggedInCallback && this._mFacebookLoggedInCallback.call(this, this._mFacebookUserID)) : "not_authorized" === a.status ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "user is logged into Facebook but has not authorized the app"), null !== this._mFacebookLoginRequiredCallback && this._mFacebookLoginRequiredCallback.call(this)) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "user is not logged into Facebook"), null !== this._mFacebookLoginRequiredCallback && this._mFacebookLoginRequiredCallback.call(this))
        },
        promptForFacebookAuthorization: function(a) {
            this._mFacebookLoginRequiredCallback = a ? a : null, TGS.Debug.Log(TGS.Debug.LOG_INFO, "prompting user for Facebook login and/or app authorization...");
            var b = "publish_actions,user_games_activity";
            TGS.Leaderboard.RequestUserLocation && (b += ",user_location"), FB.login(this.onGetFBLoginStatus.bind(this), {
                scope: b
            })
        },
        getLoginStatus: function() {
            var a = TGS.localStorage.getItem(TGS._sLSKeys.TGS_userid);
            a ? (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "userID retrieved from local storage: " + a), this._mUsername = TGS.localStorage.getItem(TGS._sLSKeys.TGS_username), this._mAvatarURL = TGS.localStorage.getItem(TGS._sLSKeys.TGS_avatar), this._mUserLocation = TGS.localStorage.getItem(TGS._sLSKeys.TGS_location)) : (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "userID was not available in local storage"), a = this.generateGuestUserID()), a === TGS.localStorage.getItem(TGS._sLSKeys.TGS_loggedin_user) && this.verifyLocalLogin(a), null !== this.onUserInfoAvailable && (a = TGS.localStorage.getItem(TGS._sLSKeys.TGS_userid), this.onUserInfoAvailable.call(this, a))
        },
        generateGuestUserID: function() {
            var a = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(a) {
                var b = 16 * Math.random() | 0,
                    c = "x" == a ? b : 3 & b | 8;
                return c.toString(16)
            });
            return TGS.Debug.Log(TGS.Debug.LOG_INFO, "generated GUID for guest: " + a), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "saving userID to local storage: " + a), TGS.localStorage.setItem(TGS._sLSKeys.TGS_userid, a), a
        },
        verifyLocalLogin: function(a) {
            this.userLoggedIn(null, a)
        },
        userLoggedIn: function(a, b) {
            var c = TGS.localStorage.getItem(TGS._sLSKeys.TGS_loggedin_user);
            if (c && this._mLoggedIn) return void(b === c ? TGS.Debug.Log(TGS.Debug.LOG_WARNING, "PartnerBridge.userLoggedIn: user " + b + " is already logged in") : (TGS.Debug.Log(TGS.Debug.LOG_ERROR, "PartnerBridge.userLoggedIn: there is already a logged in user"), TGS._LoginFailed(a)));
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "user '" + b + "' is logging in...");
            var d = c === b.toString();
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "(user was " + (d ? "" : "NOT") + " previously logged in)"), TGS.Debug.Log(TGS.Debug.LOG_INFO, "user name: " + this._mUsername), TGS.Debug.Log(TGS.Debug.LOG_INFO, "user avatar: " + this._mAvatarURL), TGS.Debug.Log(TGS.Debug.LOG_INFO, "user location: " + this._mUserLocation), this._mUsername && TGS.localStorage.setItem(TGS._sLSKeys.TGS_username, this._mUsername), this._mAvatarURL && TGS.localStorage.setItem(TGS._sLSKeys.TGS_avatar, this._mAvatarURL), this._mUserLocation && TGS.localStorage.setItem(TGS._sLSKeys.TGS_location, this._mUserLocation);
            var e = null == c;
            TGS.localStorage.setItem(TGS._sLSKeys.TGS_loggedin_user, b.toString()), TGS.localStorage.setItem(TGS._sLSKeys.TGS_userid, b), TGS._sUserID = b.toString(), this._mLoggedIn = !0, TGS.DataStore._sSaveToTGSServer = !0, a ? TGS.DataStore.ReloadData({
                location: d ? "local" : "remote",
                useLocalIfEmpty: e,
                onSuccess: TGS._LoginSucceeded.bind(null, a)
            }) : TGS._LoginSucceeded()
        },
        updateLocalStorageData: function() {
            var a = TGS.localStorage.getItem("TGS_userid");
            a && (TGS.localStorage.setItem(TGS._sLSKeys.TGS_userid, a), TGS.localStorage.removeItem("TGS_userid"));
            var b = TGS.localStorage.getItem("TGS_datastore");
            b && (TGS.localStorage.setItem(TGS._sLSKeys.TGS_datastore, b), TGS.localStorage.removeItem("TGS_datastore"))
        },
        getImageURL: function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "PartnerBridge.getImageURL called");
            var b = a.item.image;
            if ("undefined" != typeof window.TGE) {
                var c = window.TGE.AssetManager,
                    d = c.GetImage(a.item.image);
                d && (b = d.src, TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "full image url is " + b))
            }
            return b
        },
        openURL: function(a, b, c) {
           // window.open(a, b || "_blank", c)
        },
        showSplashScreen: function(a) {
            if (!this._mSplashScreen || this._mSplashShown) return void(a.closeCallback && a.closeCallback());
            this._mSplashShown = !0;
            var b = document.createElement("div");
            b.id = "tgs-splash", b.style.zIndex = 1e3, b.style.backgroundColor = this._mSplashBackgroundColor, b.style.top = 0, b.style.left = 0, b.style.position = "fixed", b.style.width = "100%", b.style.height = "100%", b.style.textAlign = "center", document.body.insertBefore(b, document.body.firstChild);
            var c = Math.round(.7 * Math.min(window.innerWidth, window.innerHeight)),
                d = document.createElement("div");
            d.style.position = "absolute", d.style.width = c + "px", d.style.height = c + "px", b.insertBefore(d, b.firstChild);
            var e = document.createElement("img");
            e.src = this._mSplashImage || "//sdk.tresensa.com/tgs/" + TGS._sPartnerID + "/splash.png", e.style.width = "100%", d.insertBefore(e, d.firstChild);
            var f = .5 * window.innerWidth - c / 2,
                g = .45 * window.innerHeight - c / 2;
            d.style.top = g.toString() + "px", d.style.left = f.toString() + "px", this._mSplashScreen = !1, setTimeout(this.closeSplashScreen.bind(this, b, a.closeCallback), 1e3 * this._mSplashTimer)
        },
        closeSplashScreen: function(a, b) {
            this._splashOpacity = 100, this._splashTimeoutID = setInterval(this.fadeSplashScreen.bind(this, a, b), 10)
        },
        fadeSplashScreen: function(a, b) {
            this._splashOpacity -= 2, a.style.opacity = this._splashOpacity / 100, a.style.filter = "alpha(opacity=" + this._splashOpacity + ")", this._splashOpacity <= 0 && (a.parentNode.removeChild(a), clearInterval(this._splashTimeoutID), b && b())
        },
        advertising_injectAd: function(a, b) {
            var c;
            c = 3 == a.placement ? TGS._sConfig.ADS.VALUEEXCHANGE_PLACEMENT_ID : 2 == a.placement ? TGS._sConfig.ADS.PRELOADER_PLACEMENT_ID || TGS._sConfig.ADS.INTERSTITIAL_PLACEMENT_ID : 1 == a.placement ? TGS._sConfig.ADS.INTERSTITIAL_PLACEMENT_ID : TGS._sConfig.ADS.DISPLAY_PLACEMENT_ID;
            //var d = this.advertising_getAdServerURL(c, a.placement ? 0 : 170); edit by jiazom
			var d = this.advertising_getAdServerURL(c, a.placement ? 0 : 0);
            /*
			a.element = document.createElement("div"), a.element.id = "tgs_display_ad", a.element.style.position = "absolute", a.element.style.zIndex = 3, a.element.style.webkitTransformOrigin = "center center", a.element.style.MozTransformOrigin = "center center", a.element.style.msTransformOrigin = "center center", a.element.style.OTransformOrigin = "center center", a.element.style.transformOrigin = "center center";
            var e = a.fullscreen ? "%" : "px",
                f = "<iframe id='tgs_display_ad_iframe' width='" + a.width + e + "' height='" + a.height + e + "' style='border: none; overflow: hidden;' scroll='no' src='" + d + "'></iframe>";
            3 === a.placement ? f = "<div width='" + a.width + e + "' height='" + a.height + e + "' id='tgs-ad-frame' class='tgs-ad-frame'><div class='value-exchange-message'>" + this.valueExchangeMessage + "</div><span>Advertisement</span>" + f + "</div>" : a.placement && (f = "<div width='" + a.width + e + "' height='" + a.height + e + "' id='tgs-ad-frame' class='tgs-ad-frame'><span>Advertisement</span>" + f + "</div>"), a.element.innerHTML = f, b.insertBefore(a.element, b.firstChild), a._reposition(b)
			*/
		},
        advertising_injectInterstitial: function(a) {
            var b = a.parentDiv,
                c = a.blurDiv,
                d = "undefined" == typeof a.skipDelay ? 3 : a.skipDelay,
                e = "undefined" == typeof a.overlayRed ? 1 : a.overlayRed,
                f = "undefined" == typeof a.overlayGreen ? 1 : a.overlayGreen,
                g = "undefined" == typeof a.overlayBlue ? 1 : a.overlayBlue,
                h = "undefined" == typeof a.overlayOpacity ? .6 : a.overlayOpacity;
            TGS.Utils.isTGEGame() && TGE.Game.GameDiv() ? (b || (b = TGE.Game.GameDiv()), c || (c = b.getElementsByTagName("canvas")[0])) : b || (b = document.body);
            var i, j = function() {
                    q._reposition(p), TGS.BrowserDetect.onAndroid ? (clearTimeout(i), i = setTimeout(function() {
                        q._reposition(p)
                    }, 550)) : q._reposition(p)
                },
                k = function() {
                    r.style.visibility = "visible", r.style.cursor = "pointer", r.addEventListener("click", l, !0), r.addEventListener("touchend", l, !0)
                },
                l = function() {
                    q.closeCallback = a.closeCallback, q.close(), p.parentNode.removeChild(p), r.removeEventListener("click", l), r.removeEventListener("touchend", l), s.forEach(function(a) {
                        p.removeEventListener(a, m)
                    }), window.removeEventListener("resize", j), c && c.classList.remove("tgs-blur"), document.body.classList.remove("tgs-interstitial-open")
                },
                m = function(a) {
                    return a.stopPropagation(), a.preventDefault(), a.stopImmediatePropagation(), !1
                },
                n = b.clientWidth,
                o = b.clientHeight,
                p = document.createElement("div");
           // p.id = "tgs_ad_overlay", p.style.zIndex = 11e3, p.style.backgroundColor = "rgba(" + Math.round(255 * e).toString() + "," + Math.round(255 * f).toString() + "," + Math.round(255 * g).toString() + "," + h.toString() + ")", p.style.top = 0, p.style.left = 0, b != document.body && n && o ? (p.style.position = "absolute", p.style.width = n + "px", p.style.height = o + "px") : (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "PartnerBridge.advertising_injectInterstitial: Could not determine width/height of parentDiv, going fullscreen with overlay"), p.style.position = "fixed", p.style.width = "100%", p.style.height = "100%"), b.insertBefore(p, b.firstChild);
            var q = new TGS.Advertisement(a || {}, a.placement);
            q.closeCallback = l, q._inject(p);
            var r = document.createElement("img");
            r.id = "tgs-close", r.src = TGS._IMAGES_LOCATION + "close-button.png", r.style.position = "absolute", r.style.zIndex = "100", r.style.cursor = "pointer", r.style.visibility = "hidden", r.style.padding = "10px", r.style.top = "-30px", r.style.right = "-30px", q.element.appendChild(r), d > 0 ? (q.showCloseTimeout = setTimeout(k, 1e3 * d), q.enableClose = k) : k();
            
			var s = ["click", "mousedown", "mouseup", "mousemove", "touchstart", "touchend", "touchmove"];
            s.forEach(function(a) {
                p.addEventListener(a, m, !1)
            }), window.addEventListener("resize", j, !1), c && c.classList.add("tgs-blur"), document.body.classList.add("tgs-interstitial-open")
        },
        advertising_getAdServerURL: function(a, b, c) {
            //var d = TGS._sConfig.NATIVE_APP || TGS._sConfig.TIZEN_APP ? "http:" : "", edit
               // e = c ? "addyn" : "adiframe";
            //return d = ["//adserver.adtechus.com/", e, "/3.0/5421.1/", a, "/0/", b, "/ADTECH;target=_blank", ";key=", TGS._sConfig.DST_ID, ";kvenv=", encodeURIComponent(TGS.BrowserDetect.platform), ";sub1=", encodeURIComponent(TGS._sGameID), ";sub2=", encodeURIComponent(window.location.href), ";sub3=", encodeURIComponent(TGS._sConfig.HOST)].join("")
			return d ="";
			},
        advertising_closeAd: function(a) {
            a.element && a.element.parentNode && a.element.parentNode.removeChild(a.element)
        },
        analytics_getProviders: function() {
            return [TGS.Analytics.GoogleAnalyticsProvider, TGS.Analytics.GameAnalyticsProvider, TGS.Analytics.MixPanelProvider]
        },
        preferredLanguage: function() {
            return null
        }
    }, TGS.DataStore = function() {}, TGS.DataStore.onDataChanged = null, TGS.DataStore.GameData = null, TGS.DataStore._sSaveToTGSServer = !0, TGS.DataStore._sSaveToLocalStorage = !1, TGS.DataStore.ReloadGameData = function(a, b) {
        if (!TGS._sPartnerBridge.supportsDatastore()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner");
        if (!(TGS._sPartnerID && TGS._sGameID && TGS._sUserID && TGS._sPartnerBridge && TGS._sPartnerBridge.isReady())) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.DataStore.ReloadGameData - TGS is not ready yet"), void(b && b.call(this, "TGS was not ready"));
        var c = TGS._sPartnerID;
        TGS.Debug.Log(TGS.Debug.LOG_INFO, "fetching complete game state...");
        var d = !1;
        if (TGS.DataStore._sSaveToLocalStorage) {
            var e = TGS.localStorage.getItem(TGS._sLSKeys.TGS_datastore);
            e || (e = "{}", TGS.Debug.Log(TGS.Debug.LOG_INFO, "there was no local TGS.DataStore data"), d = !0);
            var f = TGS.DataStore.GameData = JSON.parse(e);
            a && (!d || d && !TGS.DataStore._sSaveToTGSServer) && (a.call(this, f), a = null, b = null)
        }
        if (TGS.DataStore._sSaveToTGSServer) {
            var g = '{"game":"' + TGS._sGameID + '","partner":"' + c + '","user":"' + TGS._sUserID + '","keys":[]}',
                h = new TGS.DataStoreRequest;
            h.type = "reload", h.onSuccess = a, h.onFailure = b, h.params = g, h.noLocalData = d, TGS.SendMessage("game_data", "get", g, TGS.DataStore._SuccessCallback.bind(this, h), TGS.DataStore._ErrorCallback.bind(this, h))
        }
    }, TGS.DataStore.ReloadData = function(a) {
        if (!TGS._sPartnerBridge.supportsDatastore()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner");
        if (!(TGS._sPartnerID && TGS._sGameID && TGS._sUserID && TGS._sPartnerBridge && TGS._sPartnerBridge.isReady())) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.DataStore.ReloadGameData - TGS is not ready yet"), void(a.onFailure && a.onFailure.call(this, "TGS was not ready"));
        var b = TGS._sPartnerID;
        if (TGS.Debug.Log(TGS.Debug.LOG_INFO, "fetching complete game state (" + a.location + ")..."), "local" === a.location) {
            var c = TGS.localStorage.getItem(TGS._sLSKeys.TGS_datastore);
            c || (c = "{}", TGS.Debug.Log(TGS.Debug.LOG_INFO, "there was no local TGS.DataStore data"));
            var d = TGS.DataStore.GameData = JSON.parse(c);
            return void(a.onSuccess && a.onSuccess.call(this, d))
        }
        if ("remote" === a.location) {
            var e = '{"game":"' + TGS._sGameID + '","partner":"' + b + '","user":"' + TGS._sUserID + '","keys":[]}',
                f = new TGS.DataStoreRequest;
            f.type = "reload", f.useLocalIfEmpty = a.useLocalIfEmpty, f.onSuccess = a.onSuccess, f.onFailure = a.onFailure, TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "requesting game data with params: " + e), TGS.SendMessage("game_data", "get", e, TGS.DataStore._ReloadSuccessCallback.bind(this, f), TGS.DataStore._ErrorCallback.bind(this, f))
        }
    }, TGS.DataStore._ReloadSuccessCallback = function(a, b) {
        if (!b || "undefined" == typeof b.code) return void TGS.DataStore._ErrorCallback(a, "response object is malformed", b);
        if (0 !== b.code) return void TGS.DataStore._ErrorCallback(a, "internal request error code: " + b.code, b);
        TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "received game data: " + JSON.stringify(b.values));
        var c = b.values;
        "[object Array]" === Object.prototype.toString.call(c) && (c = {});
        var d = !0;
        for (var e in c)
            if (c.hasOwnProperty(e)) {
                d = !1;
                break
            }
        if (d && a.useLocalIfEmpty) {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "there was no remote game data for this user, falling back to local storage...");
            var f = TGS.localStorage.getItem(TGS._sLSKeys.TGS_datastore);
            f || (f = "{}"), c = JSON.parse(f), d = !1
        }
        if (TGS.DataStore.GameData = c, d) TGS.localStorage.removeItem(TGS._sLSKeys.TGS_datastore);
        else {
            var f = JSON.stringify(TGS.DataStore.GameData);
            TGS.localStorage.setItem(TGS._sLSKeys.TGS_datastore, f)
        }
        TGS.DataStore._DataUpdated(), a.onSuccess ? a.onSuccess.call(this, c) : TGS.Debug.Log(TGS.Debug.LOG_INFO, "remote DataStore request was successful")
    }, TGS.DataStore.ClearLocalData = function() {
        TGS.DataStore.GameData = {}, TGS.localStorage.removeItem(TGS._sLSKeys.TGS_datastore), TGS.DataStore._DataUpdated()
    }, TGS.DataStore._DataUpdated = function() {
        if (window.TGE) {
            var a = TGE.Game.GetInstance();
            a && a._onTGSDatastoreUpdated && a._onTGSDatastoreUpdated()
        }
        TGS.DataStore.onDataChanged && TGS.DataStore.onDataChanged.call(this)
    }, TGS.DataStore.ImportGameData = function(a, b, c, d) {
        if (!TGS._sPartnerBridge.supportsDatastore()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner");
        if (!(TGS._sPartnerID && TGS._sGameID && TGS._sUserID && TGS._sPartnerBridge && TGS._sPartnerBridge.isReady())) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.DataStore.ReloadGameData - TGS is not ready yet"), void(d && d.call(this, "TGS was not ready"));
        TGS.Debug.Log(TGS.Debug.LOG_INFO, "importing complete game state...");
        var e = '{"game":"' + TGS._sGameID + '","partner":"' + a + '","user":"' + b + '","keys":[]}',
            f = new TGS.DataStoreRequest;
        f.type = "reload", f.onSuccess = c, f.onFailure = d, f.params = e, TGS.SendMessage("game_data", "get", e, TGS.DataStore._SuccessCallback.bind(this, f), TGS.DataStore._ErrorCallback.bind(this, f))
    }, TGS.DataStore._SuccessCallback = function(a, b) {
        if (!b || "undefined" == typeof b.code) return void TGS.DataStore._ErrorCallback(a, "response object is malformed", b);
        if (0 !== b.code) return void TGS.DataStore._ErrorCallback(a, "internal request error code: " + b.code, b);
        if (!a.noLocalData && TGS.DataStore._sSaveToLocalStorage) return void TGS.Debug.Log(TGS.Debug.LOG_INFO, "remote DataStore request was successful");
        var c = null;
        "reload" === a.type && (c = b.values, "[object Array]" === Object.prototype.toString.call(c) && (c = {}), TGS.DataStore.GameData = c), a.onSuccess ? a.onSuccess.call(this, c) : TGS.Debug.Log(TGS.Debug.LOG_INFO, "remote DataStore request was successful")
    }, TGS.DataStore._ErrorCallback = function(a, b, c) {
        a.onFailure ? a.onFailure.call(this, b, c) : TGS.Debug.Log(TGS.Debug.LOG_ERROR, "remote DataStore request failed: " + b)
    }, TGS.DataStore.FetchStringValue = function(a, b) {
        return TGS._sPartnerBridge.supportsDatastore() ? TGS.IsReady() ? "undefined" == typeof TGS.DataStore.GameData[a] ? (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "no value stored for '" + a + "', using default"), b) : TGS.DataStore.GameData[a] : (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "DataStore tried to fetch value '" + a + "' before TGS was ready"), b) : (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner"), b)
    }, TGS.DataStore.FetchIntValue = function(a, b) {
        return parseInt(TGS.DataStore.FetchStringValue(a, b))
    }, TGS.DataStore.FetchFloatValue = function(a, b) {
        return parseFloat(TGS.DataStore.FetchStringValue(a, b))
    }, TGS.DataStore.SaveValue = function(a, b, c, d) {
        if (!TGS._sPartnerBridge.supportsDatastore()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner");
        if (!TGS.IsReady()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "DataStore tried to save value for '" + a + "' before TGS was ready");
        var e = TGS._sPartnerID;
        TGS.Debug.Log(TGS.Debug.LOG_INFO, "saving new value for '" + a + "' to datastore...");
        var f = {};
        f[a] = b;
        var g = '"values":' + JSON.stringify(f);
        if (TGS.DataStore.GameData[a] = b.toString(), TGS.DataStore._sSaveToLocalStorage) {
            var h = JSON.stringify(TGS.DataStore.GameData);
            TGS.localStorage.setItem(TGS._sLSKeys.TGS_datastore, h), c && c.call(this, null)
        }
        if (TGS.DataStore._sSaveToTGSServer) {
            TGS.DataStore._sSaveToLocalStorage && (c = null, d = null);
            var i = '{"game":"' + TGS._sGameID + '","partner":"' + e + '","user":"' + TGS._sUserID + '",' + g + "}",
                j = new TGS.DataStoreRequest;
            j.type = "save", j.onSuccess = c, j.onFailure = d, j.params = i, TGS.SendMessage("game_data", "set", i, TGS.DataStore._SuccessCallback.bind(this, j), TGS.DataStore._ErrorCallback.bind(this, j))
        }
        TGS.DataStore._DataUpdated()
    }, TGS.DataStore.SaveValues = function(a, b, c) {
        if (!TGS._sPartnerBridge.supportsDatastore()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner");
        if (!TGS.IsReady()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "DataStore tried to save values before TGS was ready");
        var d = TGS._sPartnerID;
        if (TGS.DataStore.SaveValuesLocally(a), TGS.DataStore._sSaveToLocalStorage) {
            var e = JSON.stringify(TGS.DataStore.GameData);
            TGS.localStorage.setItem(TGS._sLSKeys.TGS_datastore, e), b && b.call(this, null)
        }
        if (TGS.DataStore._sSaveToTGSServer) {
            TGS.DataStore._sSaveToLocalStorage && (b = null, c = null);
            var f = '"values":' + JSON.stringify(a);
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "saving new values to server " + f + "...");
            var g = '{"game":"' + TGS._sGameID + '","partner":"' + d + '","user":"' + TGS._sUserID + '",' + f + "}",
                h = new TGS.DataStoreRequest;
            h.type = "save", h.onSuccess = b, h.onFailure = c, h.params = g, TGS.SendMessage("game_data", "set", g, TGS.DataStore._SuccessCallback.bind(this, h), TGS.DataStore._ErrorCallback.bind(this, h))
        }
    }, TGS.DataStore.SaveValuesLocally = function(a, b) {
        if (b = "undefined" == typeof b ? !1 : b, !TGS._sPartnerBridge.supportsDatastore()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "datastore operations are not available on this distribution partner");
        if (!TGS.IsReady()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "DataStore tried to save values before TGS was ready");
        for (var c in a) a.hasOwnProperty(c) && (TGS.DataStore.GameData[c] = a[c].toString());
        if (b) {
            var d = JSON.stringify(TGS.DataStore.GameData);
            TGS.localStorage.setItem(TGS._sLSKeys.TGS_datastore, d)
        }
        TGS.DataStore._DataUpdated()
    }, TGS.DataStoreRequest = function() {
        this.type = "", this.onSuccess = null, this.onFailure = null, this.noLocalData = !1
    }, TGS.Microtransactions = function() {}, TGS.Microtransactions.DefaultPurchaseFailedMessage = "The purchase was not completed.", TGS.Microtransactions.UseTGSErrorMessages = !0, TGS.Microtransactions._PendingRequest = null, TGS.Microtransactions._PurchaseOverlay = null, TGS.Microtransactions._sIAPProducts = [], TGS.Microtransactions._sAppURLs = [], TGS.Microtransactions._sNumRestoredPurchases = 0, TGS.Microtransactions.RestorePurchaseCallback = null, TGS.Microtransactions.RestorePurchases = function() {
        TGS.Debug.Log(TGS.Debug.LOG_INFO, "restore purchases requested..."), TGS.Microtransactions._PurchaseOverlay = TGS.LoadingOverlay(), TGS.Microtransactions._sNumRestoredPurchases = 0, TGS._sPartnerBridge.restorePurchases()
    }, TGS.Microtransactions._RestorePurchaseCallback = function(a) {
        return null === TGS.Microtransactions.RestorePurchaseCallback ? void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "no TGS.Microtransactions.RestorePurchaseCallback defined, cannot restore " + a) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "calling RestorePurchaseCallback for TGS item " + a), TGS.Microtransactions.RestorePurchaseCallback(a), void TGS.Microtransactions._sNumRestoredPurchases++)
    }, TGS.Microtransactions._RestorePurchasesDone = function(a) {
        TGS.Debug.Log(TGS.Debug.LOG_INFO, "restoring purchases " + (a ? "successful" : "failed") + " (" + TGS.Microtransactions._sNumRestoredPurchases + " total)"), TGS.Microtransactions._PurchaseOverlay && (TGS.Microtransactions._PurchaseOverlay.parentNode.removeChild(TGS.Microtransactions._PurchaseOverlay), TGS.Microtransactions._PurchaseOverlay = null), a && TGS.Microtransactions._sNumRestoredPurchases > 0 ? (TGS.OverlayMessage({
            title: "Done!",
            message: "Your non-consumable purchases have been successfully restored."
        }), TGS.DataStore._DataUpdated()) : TGS.OverlayMessage(a && 0 === TGS.Microtransactions._sNumRestoredPurchases ? {
            title: "Sorry...",
            message: "We did not find any previous non-consumable purchases associated with your account."
        } : {
            title: "Sorry...",
            message: "Unable to restore purchases."
        })
    }, TGS.Microtransactions.PriceAsFormattedString = function(a) {
        return TGS._sPartnerBridge.freeIAP || TGS._sPartnerBridge.offerValueExchange ? "FREE!" : TGS._sPartnerBridge.priceAsFormattedString(a)
    }, TGS.Microtransactions.FormattedPriceForItem = function(a) {
        return TGS._sPartnerBridge.freeIAP || TGS._sPartnerBridge.offerValueExchange ? "FREE!" : TGS._sPartnerBridge.formattedPriceForItem(a)
    }, TGS.Microtransactions.CurrencyIcon = function() {
        return TGS._sPartnerBridge.supportsMicrotransactions() ? TGS._sPartnerBridge.currencyIcon() : null
    }, TGS.Microtransactions.PriceAsUSD = function(a) {
        return TGS._sPartnerBridge.freeIAP || TGS._sPartnerBridge.offerValueExchange ? 0 : (10 * a / 100 - .01).toFixed(2)
    }, TGS.Microtransactions.PaymentProviderName = function() {
        return TGS._sPartnerBridge.offerValueExchange ? "TreSensaValueExchange" : TGS._sPartnerBridge.paymentProviderName()
    }, TGS.Microtransactions.GetIAPProducts = function() {
        return TGS.Microtransactions._sIAPProducts
    }, TGS.Microtransactions.GetIAPProduct = function(a, b) {
        b = b || "id";
        for (var c = 0; c < TGS.Microtransactions._sIAPProducts.length; c++) {
            var d = TGS.Microtransactions._sIAPProducts[c];
            if (d[b] === a) return d
        }
        return null
    }, TGS.Microtransactions.HasNonConsumables = function() {
        for (var a = 0; a < TGS.Microtransactions._sIAPProducts.length; a++)
            if (!TGS.Microtransactions._sIAPProducts[a].consumable) return !0;
        return !1
    }, TGS.Microtransactions.PurchaseProduct = function(a) {
        if (!TGS._sPartnerBridge.supportsMicrotransactions()) return void TGS.Microtransactions.RedirectToIAPPartner();
        if (null !== TGS.Microtransactions._PendingRequest) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "purchase request ignored - one is already pending");
        var b = a.onFailure;
        TGS.Microtransactions.UseTGSErrorMessages && (b = TGS.Microtransactions._PurchaseFailedMessage.bind(this, a.onFailure));
        var c = !0,
            d = "";
        if ("object" != typeof a ? (c = !1, d += "params ") : ("undefined" == typeof a.productID && (c = !1, d += "productID "), "object" != typeof a.gameDataUpdates ? (c = !1, d += "gameDataUpdates ") : 0 == Object.keys(a.gameDataUpdates).length && (c = !1, d += "the gameDataUpdates object must contain the datastore key/value pairs to be updated if the transaction is successful. Do NOT use the onSuccess callback to apply purchase rewards!")), !c) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "Invalid values sent to TGS.Microtransactions.PurchaseProduct: " + d), void(a && a.onFailure && b.call(this, a.productID, TGS.Microtransactions.DefaultPurchaseFailedMessage));
        var e = TGS.Microtransactions.GetIAPProduct(a.productID);
        if (!e) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "Unknown IAP product: " + a.productID), void(a.onFailure && b.call(this, a.productID, TGS.Microtransactions.DefaultPurchaseFailedMessage));
        if (!e.consumable && null === TGS.Microtransactions.RestorePurchaseCallback) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "Attempt to purchase non-consumable item " + a.productID + " without defining a TGS.Microtransactions.RestorePurchaseCallback (TGE games can also implement onTGSPurchaseRestored in their game class)"), void(a.onFailure && b.call(this, a.productID, TGS.Microtransactions.DefaultPurchaseFailedMessage));
        if (!TGS.LoggedIn()) return void TGS.OverlayMessage({
            title: "Login Required",
            message: "You will now be asked to login. Once you are logged in you will be able to make in-app purchases.",
            buttonAction: TGS.LoginUser.bind(this, {
                onUserCancel: TGS.OverlayMessage.bind(this, {
                    title: "Login Required",
                    message: "You must be logged in to make in-app purchases."
                }),
                onFailure: TGS.OverlayMessage.bind(this, {
                    title: "Login Error",
                    message: "There was a problem logging you in."
                })
            })
        });
        var f = a.productID,
            g = a.onSuccess,
            h = b,
            i = a.gameDataUpdates,
            j = new TGS.Microtransactions.Item(f, e.title, e.description, e.price, e.iconUrl, e.partnerProductID);
        if (!TGS.IsReady()) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "tried to purchase product " + f + " but TGS was not ready"), void(h && h.call(this, f, TGS.Microtransactions.DefaultPurchaseFailedMessage));
        var k = new TGS.Microtransactions.Request;
        k.item = j, k.onSuccess = g, k.onFailure = h, k.userErrorMessage = TGS.Microtransactions.DefaultPurchaseFailedMessage, k.gameDataUpdates = i, TGS.Microtransactions._BeginNewRequest(k), TGS._sPartnerBridge.logTransactionBeforePartnerRequest() ? TGS.Microtransactions._LogPurchaseRequest(k) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "requesting purchase from partner..."), TGS.Microtransactions._DoPurchaseRequest(k))
    }, TGS.Microtransactions.PurchaseItem = function(a) {
        TGS.Debug.Log(TGS.Debug.LOG_ERROR, "The TGS.Microtransactions.PurchaseItem IAP CALL IS NO LONGER SUPPORTED! USE TGS.Microtransactions.PurchaseProduct INSTEAD!!"), a && a.onFailure && a.onFailure.call(this, a.itemID, TGS.Microtransactions.DefaultPurchaseFailedMessage)
    }, TGS.Microtransactions.RedirectToIAPPartner = function() {
        var a = null,
            b = null,
            c = "In-app purchasing is not supported here.",
            d = !1;
        if (TGS.Microtransactions._sAppURLs.facebook_app_url && (a = TGS.Microtransactions._sAppURLs.facebook_app_url, b = TGS._IMAGES_LOCATION + "redirects/facebook.png"), TGS.BrowserDetect.oniOS && TGS.Microtransactions._sAppURLs.itunes_app_url) {
            a = TGS.Microtransactions._sAppURLs.itunes_app_url, b = TGS._IMAGES_LOCATION + "redirects/itunes.png";
            var d = !0
        } else if (TGS.BrowserDetect.onAndroid && TGS.Microtransactions._sAppURLs.googleplay_app_url) {
            a = TGS.Microtransactions._sAppURLs.googleplay_app_url, b = TGS._IMAGES_LOCATION + "redirects/googleplay.png";
            var d = !0
        } else if ("Kindle Fire" === TGS.BrowserDetect.platform && TGS.Microtransactions._sAppURLs.amazon_app_url) {
            a = TGS.Microtransactions._sAppURLs.amazon_app_url, b = TGS._IMAGES_LOCATION + "redirects/amazon.png";
            var d = !0
        } else if (TGS.BrowserDetect.onWindowsMobile && TGS.Microtransactions._sAppURLs.windows_app_url) {
            a = TGS.Microtransactions._sAppURLs.windows_app_url, b = TGS._IMAGES_LOCATION + "redirects/windows.png";
            var d = !0
        }
        a && (c += " You can buy items by " + (d ? "downloading the app:" : "playing the game on:")), TGS.Debug.Log(TGS.Debug.LOG_INFO, "IAP is not available on this partner, suggesting redirect to " + a), TGS.OverlayMessage({
            title: "Sorry!",
            message: c,
            buttonText: "",
            button2Image: b,
            button2Callback: function() {
                window.open(a, "_blank")
            }
        })
    }, TGS.Microtransactions._PurchaseFailedMessage = function(a, b, c) {
        "string" == typeof c && c.length > 0 ? TGS.OverlayMessage({
            title: "Purchase Failed",
            message: c
        }) : "object" == typeof c && TGS.OverlayMessage(c), a && a.call(this, b, c)
    }, TGS.Microtransactions._LogPurchaseRequest = function(a) {
        TGS.Debug.Log(TGS.Debug.LOG_INFO, "user request to purchase item " + a.item.id + "...");
        var b = '{"game":"' + TGS._sGameID + '","partner":"' + TGS._sPartnerID + '","user":"' + TGS._sUserID + '","item":"' + a.item.id + '"}';
        TGS.SendMessage("mtx/mtx_data", "add", b, TGS.Microtransactions._InitiatePurchase.bind(this, a), TGS.Microtransactions._LoggingPurchaseFailed.bind(this, a))
    }, TGS.Microtransactions._InitiatePurchase = function(a, b) {
        if (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "purchase request id received: " + JSON.stringify(b)), !b || "undefined" == typeof b.code) return TGS.Debug.Log(TGS.Debug.LOG_INFO, "purchase request response was corrupt"), void TGS.Microtransactions._LoggingPurchaseFailed(a);
        if (0 !== b.code) return TGS.Debug.Log(TGS.Debug.LOG_INFO, "purchase request response contained error code: " + b.code), void TGS.Microtransactions._LoggingPurchaseFailed(a);
        var c = parseInt(b.id);
        return isNaN(c) || 0 >= c ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "transaction id is invalid: " + c.toString()), void TGS.Microtransactions._LoggingPurchaseFailed(a)) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "transaction id is: " + c), a.transactionID = c, TGS.Debug.Log(TGS.Debug.LOG_INFO, "requesting purchase from partner..."), void TGS.Microtransactions._DoPurchaseRequest(a))
    }, TGS.Microtransactions._DoPurchaseRequest = function(a) {
        var b = TGS._sPartnerBridge;
        if (b.freeIAP) {
            a.partnerTransactionID = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(a) {
                var b = 16 * Math.random() | 0,
                    c = "x" == a ? b : 3 & b | 8;
                return c.toString(16)
            });
            var c = a.onSuccess;
            a.onSuccess = function() {
                TGS.OverlayMessage({
                    title: b.freeIAPTitle,
                    message: b.freeIAPMessage
                }), c && c(a.item.id)
            }, TGS.Microtransactions._PartnerPurchaseSuccessful(a)
        } else b.offerValueExchange ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "initiating value exchange ad for item '" + a.item.id + "'..."), TGS.Microtransactions._PurchaseOverlay.style.display = "none", TGS.Advertisement.DisplayValueExchangeAd({
            closeCallback: function() {
                a.partnerTransactionID = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(a) {
                    var b = 16 * Math.random() | 0,
                        c = "x" == a ? b : 3 & b | 8;
                    return c.toString(16)
                }), TGS.Microtransactions._PurchaseOverlay.style.display = "block", TGS.Microtransactions._PartnerPurchaseSuccessful(a)
            }
        })) : TGS._sPartnerBridge.purchaseItem(a)
    }, TGS.Microtransactions._LoggingPurchaseFailed = function(a, b, c) {
        var d = TGS.Microtransactions.DefaultPurchaseFailedMessage,
            e = "could not record IAP request";
        c && 12 === c.code && (d = "You already own this item.", e = "IAP was already purchased by user"), TGS.Debug.Log(TGS.Debug.LOG_ERROR, e), a.onFailure && a.onFailure.call(this, a.item.id, d), TGS.Microtransactions._ClosePendingRequest()
    }, TGS.Microtransactions._PartnerPurchaseSuccessful = function(a) {
        if (console.log(JSON.stringify(a)), TGS.Debug.Log(TGS.Debug.LOG_INFO, "purchase successful for item " + a.item.id), TGS.Microtransactions._SavePurchaseLocally(a.gameDataUpdates), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "local game data has now been updated"), TGS._sPartnerBridge.serverHandlesMicrotransactionResponse()) TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "server has already logged transaction"), a.onSuccess && a.onSuccess.call(this, a.item.id);
        else if (TGS._sPartnerBridge.logTransactionBeforePartnerRequest()) {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "sending transaction response and game data updates to server...");
            var b = '{"id":' + a.transactionID + ',"state":1,"partner_transaction_id":"' + a.partnerTransactionID + '","credits":' + (a.usingCredits ? "true" : "false") + ',"notes":null,"game_data_changes":' + JSON.stringify(a.gameDataUpdates) + "}";
            TGS.SendMessage("mtx/mtx_data", "update", b, TGS.Microtransactions._TransactionFinalized.bind(this, a, !0), TGS.Microtransactions._FinalizationFailed.bind(this, a, !0))
        } else {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "sending full transaction info to server...");
            var b = '{"game":"' + TGS._sGameID + '","partner":"' + TGS._sPartnerID + '","user":"' + TGS._sUserID + '","item":"' + a.item.id + '","credits":' + (a.usingCredits ? "true" : "false") + ',"state":1,"partner_transaction_id":"' + a.partnerTransactionID + '","notes":null,"game_data_changes":' + JSON.stringify(a.gameDataUpdates) + "}";
            TGS.SendMessage("mtx/mtx_data", "add", b, TGS.Microtransactions._TransactionFinalized.bind(this, a, !0), TGS.Microtransactions._FinalizationFailed.bind(this, a, !0))
        }
        TGS.Microtransactions._ClosePendingRequest(), TGS._sPartnerBridge.purchaseComplete(a), TGS.Analytics._logPurchase(a)
    }, TGS.Microtransactions._PartnerPurchaseFailed = function(a) {
        if (TGS.Debug.Log(TGS.Debug.LOG_ERROR, "purchase failed for item " + a.item.id + ", reason: " + a.internalErrorMessage), TGS._sPartnerBridge.serverHandlesMicrotransactionResponse()) TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "server has already logged transaction"), a.onFailure && a.onFailure.call(this, a.item.id, a.userErrorMessage);
        else if (TGS._sPartnerBridge.logTransactionBeforePartnerRequest()) {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "sending transaction response to server...");
            var b = '{"id":' + a.transactionID + ',"state":2,"partner_transaction_id":"' + a.partnerTransactionID + '","credits":' + (a.usingCredits ? "true" : "false") + ',"notes":"' + a.internalErrorMessage + '","game_data_changes":null}';
            TGS.SendMessage("mtx/mtx_data", "update", b, TGS.Microtransactions._TransactionFinalized.bind(this, a, !1), TGS.Microtransactions._FinalizationFailed.bind(this, a, !1))
        } else {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "sending full transaction info to server...");
            var b = '{"game":"' + TGS._sGameID + '","partner":"' + TGS._sPartnerID + '","user":"' + TGS._sUserID + '","item":"' + a.item.id + '","credits":' + (a.usingCredits ? "true" : "false") + ',"state":2,"partner_transaction_id":"' + a.partnerTransactionID + '","notes":"' + a.internalErrorMessage + '","game_data_changes":null}';
            TGS.SendMessage("mtx/mtx_data", "add", b, TGS.Microtransactions._TransactionFinalized.bind(this, a, !1), TGS.Microtransactions._FinalizationFailed.bind(this, a, !1))
        }
        TGS.Microtransactions._ClosePendingRequest()
    }, TGS.Microtransactions._TransactionFinalized = function(a, b) {
        TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, (b ? "successful" : "failed") + " transaction " + a.transactionID + " has been logged"), b && a.onSuccess ? a.onSuccess.call(this, a.item.id) : !b && a.onFailure && a.onFailure.call(this, a.item.id, a.userErrorMessage)
    }, TGS.Microtransactions._SavePurchaseLocally = function(a) {
        TGS.DataStore.SaveValuesLocally(a, TGS.DataStore._sSaveToLocalStorage)
    }, TGS.Microtransactions._FinalizationFailed = function(a, b) {
        if (TGS.Debug.Log(TGS.Debug.LOG_ERROR, (b ? "successful" : "failed") + " transaction " + a.transactionID + " could not be logged"), b && (a.internalErrorMessage = "partner transaction was successful but could not be logged to server"), a.onFailure) {
            var c = "" === a.userErrorMessage ? TGS.Microtransactions.DefaultPurchaseFailedMessage : a.userErrorMessage;
            a.onFailure.call(this, a.item.id, c)
        }
    }, TGS.Microtransactions._BeginNewRequest = function(a) {
        TGS.Microtransactions._PendingRequest = a, TGS.Microtransactions._PurchaseOverlay = TGS.LoadingOverlay()
    }, TGS.Microtransactions._ClosePendingRequest = function() {
        TGS.Microtransactions._PendingRequest = null, TGS.Microtransactions._PurchaseOverlay && (TGS.Microtransactions._PurchaseOverlay.parentNode.removeChild(TGS.Microtransactions._PurchaseOverlay), TGS.Microtransactions._PurchaseOverlay = null)
    }, TGS.Microtransactions.GetCredits = function() {
        TGS.CloseMessageOverlay(), window.open("http://fortumo.com/mobile_payments/0d8f60636b898652b94ee978ee2fc43a?cuid=" + TGS._sPartnerID + TGS._sUserID, "_self")
    }, TGS.Microtransactions.Item = function(a, b, c, d, e, f) {
        this.id = a, this.partnerProductID = f, this.title = b, this.description = c, this.price = d, this.image = e
    }, TGS.Microtransactions.Request = function() {
        this.item = null, this.partnerProductID = "", this.transactionID = -1, this.partnerTransactionID = -1, this.onSuccess = null, this.onFailure = null, this.internalErrorMessage = "", this.userErrorMessage = "", this.gameDataUpdates = null, this.usingCredits = !1
    }, TGS.BrowserDetect = {
        init: function() {
            this.browser = this.searchString(this.dataBrowser) || "an unknown browser", this.version = this.searchVersion(navigator.userAgent) || this.searchVersion(navigator.appVersion) || "an unknown version", this.platform = this.searchString(this.dataPlatform) || "an unknown OS or Device", this.OSversion = this.detectOSversion(this.platform), this.onFirefoxMobile = /Firefox/i.test(navigator.userAgent) && (/Android/i.test(navigator.userAgent) || /Mobile/i.test(navigator.userAgent)), this.oniOS = "iPhone" === this.platform || "iPad" === this.platform, this.onAndroid = "Android" === this.platform, this.onWindowsMobile = "Windows Phone" === this.platform || "Windows Tablet" === this.platform, this.isMobileDevice = !("Windows" === this.platform || "Mac" === this.platform || "Linux" === this.platform), this.usingPhoneGap = window.PhoneGap || window.cordova || window.Cordova, this.clickEvent = !this.isMobileDevice || this.onWindowsMobile ? "click" : "touchstart"
        },
        detectOSversion: function(a) {
            var b = "-1",
                c = "",
                d = navigator.userAgent.toString();
            switch (a) {
                case "Windows Phone":
                    c = /Windows Phone OS\s+[\d\.]+/, b = String(d.match(c)).substring(17, 20);
                    break;
                case "iPhone":
                case "iPad":
                    c = /OS\s+[\d\_]+/, b = String(d.match(c)).substring(3, 6);
                    break;
                case "Windows":
                    c = /Windows NT\s+[\d\.]+/;
                    var e = String(d.match(c)).substring(11, 14);
                    "6.1" == e ? b = "7" : "5.1" == e ? b = "XP" : "5.2" == e ? b = "XP" : "6.0" == e ? b = "Vista" : "5.01" == e ? b = "2000 SP1" : "5.0" == e && (b = "2000");
                    break;
                case "Mac":
                    c = /Mac OS X\s+[\d\_]+/, b = String(d.match(c)).substring(9, 13);
                    break;
                case "Android":
                    c = /ndroid\s+[\d\.]+/, b = String(d.match(c)).substring(7, 10)
            }
            return b
        },
        searchString: function(a) {
            for (var b = 0; b < a.length; b++)
                if (null != a[b]) {
                    var c = a[b].string,
                        d = a[b].prop;
                    if (this.versionSearchString = a[b].versionSearch || a[b].identity, c) {
                        if (-1 !== c.indexOf(a[b].subString)) return "Mozilla" === a[b].identity && navigator.userAgent.match(/Trident\/7\./) ? "Explorer" : a[b].identity
                    } else if (d) return a[b].identity
                }
        },
        searchVersion: function(a) {
            var b = a.indexOf(this.versionSearchString);
            if (-1 !== b) return parseFloat(a.substring(b + this.versionSearchString.length + 1))
        },
        dataBrowser: [{
            string: navigator.userAgent,
            subString: "Chrome",
            identity: "Chrome"
        }, {
            string: navigator.userAgent,
            subString: "MSIE",
            identity: "Explorer",
            versionSearch: "MSIE"
        }, {
            string: navigator.userAgent,
            subString: "Explorer",
            identity: "Explorer",
            versionSearch: "Explorer"
        }, {
            string: navigator.vendor,
            subString: "Apple",
            identity: "Safari",
            versionSearch: "Version"
        }, {
            string: navigator.userAgent,
            subString: "Firefox",
            identity: "Firefox"
        }, {
            prop: window.opera,
            identity: "Opera"
        }, {
            string: navigator.userAgent,
            subString: "Silk",
            identity: "Silk",
            versionSearch: "Silk"
        }, {
            string: navigator.userAgent,
            subString: "Kindle Fire",
            identity: "Amazon Web App",
            versionSearch: "AppleWebKit"
        }, {
            string: navigator.userAgent,
            subString: "Gecko",
            identity: "Mozilla",
            versionSearch: "rv"
        }, {
            string: navigator.userAgent,
            subString: "Mozilla",
            identity: "Netscape",
            versionSearch: "Mozilla"
        }, {
            string: navigator.userAgent,
            subString: "OmniWeb",
            versionSearch: "OmniWeb/",
            identity: "OmniWeb"
        }, {
            string: navigator.vendor,
            subString: "iCab",
            identity: "iCab"
        }, {
            string: navigator.vendor,
            subString: "KDE",
            identity: "Konqueror"
        }, {
            string: navigator.vendor,
            subString: "Camino",
            identity: "Camino"
        }, {
            string: navigator.userAgent,
            subString: "Netscape",
            identity: "Netscape"
        }, {
            string: navigator.vendor,
            subString: "BlackBerry",
            identity: "BlackBerry"
        }],
        dataPlatform: [{
            string: navigator.userAgent,
            subString: "Windows Phone",
            identity: "Windows Phone"
        }, {
            string: navigator.userAgent,
            subString: "Tablet PC",
            identity: "Windows Tablet"
        }, {
            string: navigator.platform,
            subString: "Win",
            identity: "Windows"
        }, {
            string: navigator.platform,
            subString: "Mac",
            identity: "Mac"
        }, {
            string: navigator.userAgent,
            subString: "iPhone",
            identity: "iPhone"
        }, {
            string: navigator.userAgent,
            subString: "iPad",
            identity: "iPad"
        }, {
            string: navigator.userAgent,
            subString: "iPod",
            identity: "iPod"
        }, {
            string: navigator.userAgent,
            subString: "Silk",
            identity: "Kindle Fire"
        }, {
            string: navigator.userAgent,
            subString: "Kindle Fire",
            identity: "Kindle Fire"
        }, {
            string: navigator.userAgent,
            subString: "Android",
            identity: "Android"
        }, {
            string: navigator.userAgent,
            subString: "webOS",
            identity: "webOS"
        }, {
            string: navigator.userAgent,
            subString: "Mobile",
            identity: "Mobile"
        }, {
            string: navigator.platform,
            subString: "Linux",
            identity: "Linux"
        }]
    }, TGS.BrowserDetect.init(),
    function() {
        TGS.Leaderboard = function() {}, TGS.Leaderboard._sLeaderboardDescriptors = [], TGS.Leaderboard.UseTGSErrorMessages = !0, TGS.Leaderboard.RequestUserLocation = !0, TGS.Leaderboard.GetLeaderboardDescriptors = function() {
            return TGS.Leaderboard._sLeaderboardDescriptors
        }, TGS.Leaderboard.isSupported = function() {
            return !TGS._sPartnerBridge._mDisableLeaderboard && (TGS._sPartnerBridge.implementsLeaderboard() || TGS._sPartnerBridge._mFacebookServicesAllowed || TGS._sPartnerBridge._mUseUserInfoInSLB)
        }, TGS.Leaderboard.getLabel = function(a) {
            var b = !!parseInt(TGS._sPartnerBridge._mUseUserInfoInSLB || -1 !== window.location.host.indexOf("tresensa.com") && TGS._sPartnerBridge.loggedIntoFacebook() ? 0 : TGS.localStorage.getItem(TGS._sLSKeys.TGS_pending_score + a));
            return TGS._sPartnerBridge.leaderboardLabel(b)
        }, TGS.Leaderboard.GetLeaderboardDescriptor = function(a) {
            for (var b = 0; b < TGS.Leaderboard._sLeaderboardDescriptors.length; b++) {
                var c = TGS.Leaderboard._sLeaderboardDescriptors[b];
                if (c.id === a) return c
            }
            return null
        };
        var a = {
                number: function(a, b) {
                    var c = a.toString(),
                        d = !1;
                    return b.decimal && (d = c.substr(-b.decimal), c = c.substr(0, c.length - b.decimal)), c.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + (b.decimal ? "." + d : "")
                },
                time: function(a, b) {
                    for (var c = a / 1e3, d = 0; c >= 60;) d += 1, c -= 60;
                    var e = Math.floor(c),
                        f = Math.round(100 * (c - e)),
                        g = d;
                    return b.decimal >= 1 && (g += ":" + (e > 9 ? e : "0" + e)), b.decimal >= 2 && (g += ":" + (f > 9 ? f : "0" + f)), g
                }
            },
            b = function(b, c) {
                var d = TGS.Leaderboard.GetLeaderboardDescriptor(c) || {},
                    e = d.scoreFormat || {};
                e.type = (e.type || "number").toLowerCase(), e.decimal = e.decimal || ("time" == e.type ? 2 : 0), e.prefix = e.prefix || "", e.suffix = e.suffix || "";
                var f = a[e.type] || a.number;
                return e.prefix + f(b, e) + e.suffix
            };
        TGS.Leaderboard.Show = function(a) {
            return TGS.LoggedIn() ? void(TGS._sPartnerBridge.implementsLeaderboard() ? TGS._sPartnerBridge.showLeaderboard(a) : TGS.Leaderboard._ShowSLB(a)) : void TGS.LoginUser({
                onSuccess: TGS.Leaderboard.Show.bind(this, a),
                onUserCancel: TGS.OverlayMessage.bind(this, {
                    title: "Login Required",
                    message: "You must be logged in to use the leaderboard."
                }),
                onFailure: TGS.OverlayMessage.bind(this, {
                    title: "Login Error",
                    message: "There was a problem logging you in."
                })
            })
        }, TGS.Leaderboard.SubmitScore = function(a) {
            if (TGS._sPartnerBridge.implementsLeaderboard()) {
                if (!TGS.LoggedIn()) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "user is not logged in/authorized - silent score submit ignored");
                TGS._sPartnerBridge.submitScore(a)
            } else TGS.Leaderboard._SubmitScoreSLB(a)
        }, TGS.Leaderboard.SubmitScoreAndShow = function(a) {
            return TGS.LoggedIn() ? void(TGS._sPartnerBridge.implementsLeaderboard() ? TGS._sPartnerBridge.submitScoreAndShow(a) : TGS.Leaderboard._SubmitScoreAndShowSLB(a)) : void TGS.LoginUser({
                onSuccess: TGS.Leaderboard.SubmitScoreAndShow.bind(this, a),
                onUserCancel: TGS.OverlayMessage.bind(this, {
                    title: "Login Required",
                    message: "You must be logged in to use the leaderboard."
                }),
                onFailure: TGS.OverlayMessage.bind(this, {
                    title: "Login Error",
                    message: "There was a problem logging you in."
                })
            })
        };
        var c = function(a, b, c, d) {
            var e = {
                x: 1,
                y: 1
            };
            e.x = c / a, e.y = d / b, e.x = Math.ceil(1e3 * e.x) / 1e3, e.y = Math.ceil(1e3 * e.y) / 1e3;
            var f = 1;
            return f = e.x < e.y ? e.x : e.y, Math.abs(1 - f) <= .01 && (f = 1), f
        };
        TGS.Leaderboard._SubmitScoreSLB = function(a, b) {
            var c = TGS._sUserID,
                d = TGS._sPartnerID;
            if (!TGS._sPartnerBridge._mUseUserInfoInSLB) {
                var e = TGS.Leaderboard.GetLeaderboardDescriptor(a.leaderboardID),
                    f = e && e.descending === !1,
                    g = TGS._sLSKeys.TGS_pending_score + a.leaderboardID;
                if (-1 === window.location.host.indexOf("tresensa.com")) return (f && a.score < TGS.localStorage.getItem(g) || !f && a.score > TGS.localStorage.getItem(g)) && TGS.localStorage.setItem(g, a.score), TGS.Debug.Log(TGS.Debug.LOG_WARNING, "user is not logged in/authorized on Facebook - saving score"), void(a.onSuccess && a.onSuccess.call(this, a.score, a.leaderboardID));
                if (!TGS._sPartnerBridge.loggedIntoFacebook()) return b ? void TGS._sPartnerBridge.loginToFacebook(TGS._sPartnerBridge.promptForFacebookAuthorization.bind(TGS._sPartnerBridge), TGS.Leaderboard._SubmitScoreSLB.bind(this, a)) : ((f && a.score < TGS.localStorage.getItem(g) || !f && a.score > TGS.localStorage.getItem(g)) && TGS.localStorage.setItem(g, a.score), void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "user is not logged in/authorized on Facebook - saving score"));
                c = TGS._sPartnerBridge._mFacebookUserID, d = "A0003"
            }
            var h = !0,
                i = "";
            if ("object" != typeof a ? (h = !1, i += "params ") : "number" != typeof a.score && (h = !1, i += "score "), !h) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "Invalid values sent to TGS.Leaderboard.SubmitScore for the following params: " + i), void(a && a.onFailure && a.onFailure.call(this, a.score, a.leaderboardID));
            a.leaderboardID = isNaN(parseInt(a.leaderboardID)) ? 0 : parseInt(a.leaderboardID);
            var j = "function" == typeof a.onFailure ? a.onFailure : null,
                k = "",
                l = "";
            TGS._sPartnerBridge._mUseUserInfoInSLB ? (k += ',"name":' + (TGS._sPartnerBridge._mUsername ? '"' + TGS._sPartnerBridge._mUsername + '"' : "null"), k += ',"image_url":' + (TGS._sPartnerBridge._mAvatarURL ? '"' + TGS._sPartnerBridge._mAvatarURL + '"' : "null"), k += ',"location":' + (TGS._sPartnerBridge._mUserLocation ? '"' + TGS._sPartnerBridge._mUserLocation + '"' : "null")) : l += ',"facebook_access_token":' + (TGS._sPartnerBridge._mFacebookAccessToken ? '"' + TGS._sPartnerBridge._mFacebookAccessToken + '"' : "null");
            var m = '{"game":"' + TGS._sGameID + '","partner":"' + d + '","leaderboard":"' + a.leaderboardID + '","user":"' + c + '","score":' + a.score + l + k + "}",
                n = new TGS.LeaderboardRequest;
            n.type = "add", n.params = a, n.onSuccess = a.onSuccess, n.onFailure = j, TGS.Debug.Log(TGS.Debug.LOG_INFO, "submitting new score of " + a.score + " to server..."), TGS.SendMessage("leaderboard/score", "add", m, TGS.Leaderboard._SuccessCallback.bind(this, n), TGS.Leaderboard._ErrorCallback.bind(this, n))
        }, TGS.Leaderboard._ShowSLB = function(a) {
            if (null === document.getElementById("tgs-leaderboard-container")) {
                var d = document.createElement("a");
                d.href = "TGS_DUMMY_URL";
                var e = d.href.replace("TGS_DUMMY_URL", ""),
                    f = a.score,
                    g = "undefined" != typeof window.GameConfig && "string" == typeof window.GameConfig.TITLE ? window.GameConfig.TITLE : null,
                    h = g ? g : "Check out this game!",
                    i = "See if you can beat me in this awesome game" + (g ? " called " + g : "") + ".";
                "undefined" != typeof f && (i += " I just scored " + b(f, a.leaderboardID) + ".");
                var j = {
                    shareTitle: h,
                    shareMsg: i,
                    game: TGS._sGameID,
                    partner: TGS._sPartnerID,
                    leaderboard: a.leaderboardID,
                    score: a.score || parseInt(TGS.localStorage.getItem(TGS._sLSKeys.TGS_pending_score + a.leaderboardID) || 0),
                    orientation: a.orientation || TGS._sConfig.ORIENTATION,
                    timePeriod: a.timePeriod,
                    cssUrl: a.cssUrl,
                    baseHref: e,
                    server: TGS._SERVER_LOCATION
                };
                if (TGS._sPartnerBridge._mUseUserInfoInSLB) j.userInfo = {
                    id: TGS._sUserID,
                    name: TGS._sPartnerBridge._mUsername,
                    image_url: decodeURIComponent(TGS._sPartnerBridge._mAvatarURL),
                    location: TGS._sPartnerBridge._mUserLocation
                };
                else if (-1 === window.location.host.indexOf("4399.com")) j.partner = "A0003";
                else {
                    if (!TGS._sPartnerBridge.loggedIntoFacebook()) return void TGS._sPartnerBridge.loginToFacebook(TGS._sPartnerBridge.promptForFacebookAuthorization.bind(TGS._sPartnerBridge), TGS.Leaderboard._ShowSLB.bind(this, a));
                    j.partner = "A0003", j.userInfo = {
                        id: TGS._sPartnerBridge._mFacebookUserID,
                        fbToken: TGS._sPartnerBridge._mFacebookAccessToken
                    }
                }
                var k = "//leaderboard.tresensa.com/?env=" + TGS._env + "&inGame=true&gameInfo=" + encodeURIComponent(JSON.stringify(j)),
                    l = document.createElement("div");
                l.id = "tgs-leaderboard-container";
                var m = document.createElement("div");
                if (TGS.Utils.isTGEGame() || a.canvasScaled) m.setAttribute("style", "width: 100%; height: 100%;");
                else {
                    var n = function() {
                        var a = window.innerWidth,
                            b = window.innerHeight,
                            d = "landscape" == j.orientation ? 960 : 536,
                            e = "landscape" == j.orientation ? 536 : 960,
                            f = c(d, e, a, b),
                            g = Math.floor(a / 2 - d * f / 2),
                            h = Math.floor(b / 2 - e * f / 2);
                        m.setAttribute("style", "position: absolute; left: " + g + "px; top: " + h + "px; width: " + d + "px; height: " + e + "px; -ms-transform-origin: 0% 0%; -webkit-transform-origin: 0% 0%; -moz-transform-origin: 0% 0%; -o-transform-origin: 0% 0%; transform-origin: 0% 0%; -ms-transform: scale(" + f + "); -webkit-transform: scale(" + f + "); -moz-transform: scale(" + f + "); -o-transform: scale(" + f + "); transform: scale(" + f + ");")
                    };
                    n(), window.addEventListener("resize", n)
                }
                TGS.localStorage.removeItem(TGS._sLSKeys.TGS_pending_score + a.leaderboardID);
                var o = document.createElement("iframe");
                o.setAttribute("scrolling", "no"), o.setAttribute("src", k), m.appendChild(o), l.appendChild(m);
                var p = a.gameCanvas;
                p.insertBefore(l, p.firstChild);
                var q = function() {
                        window.removeEventListener("message", s), window.removeEventListener("resize", n), l.parentNode.removeChild(l), a.onClose && a.onClose()
                    },
                    r = function() {
                        TGS.Social.Challenge({
                            title: h,
                            message: i
                        })
                    },
                    s = function(a) {
                        if (!a.origin.match("^https?://(qa-)?leaderboard.tresensa.com$")) return void TGS.Debug.Log(TGS.Debug.LOG_WARNING, "Recieved window message: " + a.data + " from unexpected origin: " + a.origin);
                        var b = JSON.parse(a.data);
                        TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "Recieved window message: " + b), "leaderboard:done" == b ? q() : "leaderboard:challenge" == b && r()
                    };
                window.addEventListener("message", s, !1), TGS.Analytics.logScreen("leaderboard")
            }
        }, TGS.Leaderboard._SubmitScoreAndShowSLB = function(a) {
            var b = a.onSuccess;
            a.onSuccess = function() {
                a.onSuccess = b, TGS.Leaderboard._ShowSLB(a)
            }, TGS.Leaderboard._SubmitScoreSLB(a, !0)
        }, TGS.Leaderboard._SuccessCallback = function(a, b) {
            return b && "undefined" != typeof b.code ? 0 !== b.code ? void TGS.Leaderboard._ErrorCallback(a, "internal request error code: " + b.code, b) : void(a.onSuccess ? a.onSuccess.call(this, a, b) : TGS.Debug.Log(TGS.Debug.LOG_INFO, "Leaderboard " + a.type + " request was successful")) : void TGS.Leaderboard._ErrorCallback(a, "response object is malformed", b)
        }, TGS.Leaderboard._ErrorCallback = function(a, b, c) {
            a.onFailure ? a.onFailure.call(this, b, c) : TGS.Debug.Log(TGS.Debug.LOG_ERROR, "Leaderboard " + a.type + " request failed: " + b)
        }, TGS.LeaderboardRequest = function() {
            this.type = "", this.params = null, this.onSuccess = null, this.onFailure = null
        }
    }(),
    function() {
        TGS.Advertisement = function(a, b) {
            a = a || {}, this.closeCallback = a.closeCallback, this.placement = b || 0, this.width = b ? 336 : 300, this.height = b ? 3 === b ? 320 : 280 : 250, this.x = a.x, this.y = a.y
        }, TGS.Advertisement.prototype = {
            _inject: function(a) {
                return this.container = a, this._handleWindowMessageBound = this._handleWindowMessage.bind(this), window.addEventListener("message", this._handleWindowMessageBound, !1), TGS._sPartnerBridge.advertising_injectAd(this, a), this
            },
            _handleWindowMessage: function(a) {
                try {
                    var b = JSON.parse(a.data)
                } catch (c) {
                    return
                }
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "Received window message: " + b), "close" == b ? this.close() : "fullscreen" == b ? this._fullscreen() : "disable-close" == b ? this._disableClose() : "enable-close" == b ? this._enableClose() : b && "resize" == b.action && this._resize(b.width, b.height)
            },
            _disableClose: function() {
                var a = document.getElementById("tgs-close");
                a.style.display = "none", this.showCloseTimeout && clearTimeout(this.showCloseTimeout)
            },
            _enableClose: function() {
                this.enableClose && this.enableClose();
                var a = document.getElementById("tgs-close");
                a.style.display = "block", a.style.visibility = "visible"
            },
            _resize: function(a, b) {
                this.width = a, this.height = b, this._reposition(this.container)
            },
            _fullscreen: function() {
                this.placement && (this.fullscreen = !0, this.width = 100, this.height = 100, this._reposition(this.container))
            },
            _reposition: function(a) {
                var b = document.getElementById("tgs_display_ad_iframe"),
                    c = document.getElementById("tgs-ad-frame");
                if (this.fullscreen) {
                    this.element.style.left = 0, this.element.style.top = 0, b.style.width = "100%", b.style.height = "100%", c.classList.add("fullscreen");
                    var d = document.getElementById("tgs_display_ad");
                    return d.style.width = "100%", d.style.height = "100%", this._disableClose(), this.element.style.webkitTransform = "scale(1)", this.element.style.MozTransform = "scale(1)", this.element.style.msTransform = "scale(1)", this.element.style.OTransform = "scale(1)", void(this.element.style.transform = "scale(1)")
                }
                var e = a == document.body ? window.innerHeight : a.clientHeight,
                    f = a == document.body ? window.innerWidth : a.clientWidth;
                if (e && f) {
                    var g = "undefined" == typeof this.x ? (f - this.width) / 2 : this.x,
                        h = "undefined" == typeof this.y ? (e - this.height) / 2 : this.y;
                    b.style.width = this.width + "px", b.style.height = this.height + "px", c && (c.style.width = this.width + "px", c.style.height = this.height + "px");
                    var i = this.height,
                        j = this.width;
                    this.placement && (i += 52, j += 52, g -= 26, h -= 26), this.scale = 1, this.placement ? this.scale = f > e ? .75 * e / i : .75 * f / j : TGS.Utils.isTGEGame() && (this.scale = TGE.Game.GetInstance()._mDivResized || 1), this.element.style.left = g + "px", this.element.style.top = h + "px", this.element.style.webkitTransform = "scale(" + this.scale + ")", this.element.style.MozTransform = "scale(" + this.scale + ")", this.element.style.msTransform = "scale(" + this.scale + ")", this.element.style.OTransform = "scale(" + this.scale + ")", this.element.style.transform = "scale(" + this.scale + ")"
                }
            },
            close: function() {
                window.removeEventListener("message", this._handleWindowMessageBound), TGS._sPartnerBridge.advertising_closeAd(this) !== !0 && this.closeCallback && this.closeCallback.call()
            }
        };
        var a, b = !0,
            c = !1;
        TGS.Advertisement.DisplayAd = function(a) {
            a = a || {};
            var b = new TGS.Advertisement(a);
            return TGS._sPartnerBridge._mDisplayAdsEnabled && ("undefined" == typeof navigator.onLine || navigator.onLine) && (b._inject(a.parentDiv), TGS.Analytics._logAdEvent("display", a.level)), b
        }, TGS.Advertisement.DisplayInterstitialAd = function(c) {
            c = c || {}, c.placement = 1;
            var d = (new Date).getTime(),
                e = 1e3 * (TGS._sConfig.ADS && TGS._sConfig.ADS.INTERSTITIAL_INITIAL_INTERVAL || 0),
                f = 1e3 * (TGS._sConfig.ADS && TGS._sConfig.ADS.INTERSTITIAL_INTERVAL || 150);
            TGS._sPartnerBridge._mInterstitialAdsEnabled && ("undefined" == typeof navigator.onLine || navigator.onLine) ? (b && (b = !1, a = d - f + e), !a || d >= a + f ? (a = d, TGS._sPartnerBridge.advertising_injectInterstitial(c || {}), TGS.Analytics._logAdEvent("interstitial", c.level)) : (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "interstitial ad interval has not been reached (" + f / 1e3 + " seconds), suppressing ad request"), c.closeCallback && c.closeCallback())) : (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "device offline, interstitial ad skipped"), c.closeCallback && c.closeCallback())
        }, TGS.Advertisement._DisplayPreloaderAd = function(a) {
            a = a || {}, a.placement = 2, c || !TGS._sPartnerBridge._mPreloaderAdsEnabled || "undefined" != typeof navigator.onLine && !navigator.onLine ? a.closeCallback && a.closeCallback() : (c = !0, TGS._sPartnerBridge.advertising_injectInterstitial(a || {}), TGS.Analytics._logAdEvent("pre-loader", a.level))
        }, TGS.Advertisement.DisplayValueExchangeAd = function(a) {
            a = a || {}, a.placement = 3, TGS._sPartnerBridge._mValueExchangeAdsEnabled && ("undefined" == typeof navigator.onLine || navigator.onLine) ? (TGS._sPartnerBridge.advertising_injectInterstitial(a || {}), TGS.Analytics._logAdEvent("valueexchange", a.level)) : a.closeCallback && a.closeCallback()
        }, TGS.Advertisement.SetupEngagementTrackers = function(a, b) {
            if (!a || !a.length || !b) return void TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "Missing engagement time or tracking urls, not starting engagement trackers.");
            var c = TGL.startTime ? (new Date).getTime() - TGL.startTime : 0,
                d = 1e3 * b - c;
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "Engagement trackers started, firing in " + d + "ms (" + c + "ms already elapsed)");
            var e = function() {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "Firing " + a.length + " engagement trackers.");
                for (var b = 0; b < a.length; b++) {
                    var c = new Image;
                    c.src = a[b]
                }
            };
            d > 0 ? setTimeout(e, d) : e()
        }
    }(),
    function() {
        var a = function(a) {
                return function(b, c, d) {
                    TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics " + a + " event: " + b + ", " + c), i(a, b, c, d)
                }
            },
            b = [/.+/i],
            c = {
                game: ["load", "begin", "pause", "resume", "end", "adrequest", "win", "lose", "restart", "login success", "login failure", "login cancel", "logout", "bookmarked"],
                level: [/^start( - .+)?$/i, /^complete( - .+)?$/i, /^fail( - .+)?$/i, /^replay( - .+)?$/i],
                achievement: b,
                share: ["twitter", "facebook", "fb", "kik", "wechat", "system_share"],
                clickthru: b,
                custom: b,
                error: b,
                moregames: b,
                challenge: ["request sent", "request cancelled", "request accepted"],
                ads: [/^display( - .+)?$/i, /^interstitial( - .+)?$/i, /^pre-loader( - .+)?$/i, /^valueexchange( - .+)?$/i]
            },
            d = function(a) {
                return function(b) {
                    return b instanceof RegExp ? b.test(a) : a === b
                }
            },
            e = [],
            f = {},
            g = !1,
            h = [],
            i = function(a, b, f, i) {
                var j, k;
                i = i || {};
                var l = i.settings || {};
                try {
                    if (a = (a || "").toLowerCase(), b = (b || "").toLowerCase(), j = c[a], !j) return void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.Analytics.trackEvent called with invalid category '" + a);
                    if (!j.some(d(b))) return void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.Analytics.trackEvent called with invalid name '" + b + "' for category '" + a);
                    if (g)
                        for (k = 0; k < e.length; k++) {
                            var m = e[k],
                                n = l[m.configName];
                            n && n.skip || e[k].trackEvent(a, b, f, i || {})
                        } else h.push(arguments)
                } catch (o) {
                    TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.Analytics.trackEvent error : " + o)
                }
            };
        TGS.Analytics = {
            _init: function(a) {
                var b, c, d, j;
                if (!g) {
                    for (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics.init called with config: " + JSON.stringify(a)), f = a, b = TGS._sPartnerBridge.analytics_getProviders() || [], TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics.init got " + b.length + " providers from partner bridge"), c = 0; c < b.length; c++) try {
                        if (d = b[c], j = new d, !f[j.configName] || !f[j.configName].ENABLED) {
                            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics.init skipping provider (not ENABLED): " + j.name);
                            continue
                        }
                        TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics.init initializing provider: " + j.name), j.init(f[j.configName] || {}) !== !1 ? e.push(j) : TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics.init " + j.name + " returned false from init, not using")
                    } catch (k) {
                        TGS.Debug.Log(TGS.Debug.LOG_ERROR, "TGS.Analytics.init error while initializing " + j.name + ": " + k)
                    }
                    h.length && setTimeout(function() {
                        for (var a = h.length - 1; a >= 0; a--) i.apply(null, h[a]);
                        h = []
                    }), g = !0, TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics.init done. Loaded providers: " + e.map(TGS.Utils.Func.prop("name")))
                }
            },
            logScreen: function(a, b) {
                b = b || {};
                var c, d = b.settings || {};
                for (c = 0; c < e.length; c++) {
                    var f = e[c],
                        g = d[f.configName];
                    g && g.skip || e[c].trackScreen(a, b || {})
                }
            },
            _logPurchase: function(a, b) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics._logPurchase " + JSON.stringify(a));
                var c;
                for (c = 0; c < e.length; c++) e[c].trackPurchase(a, b || {})
            },
            _updateUserData: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "TGS.Analytics._updateUserData " + JSON.stringify(a));
                var b;
                for (b = 0; b < e.length; b++) e[b].updateUserData && e[b].updateUserData(a || {})
            },
            logGameEvent: a("game"),
            _logShareEvent: a("share"),
            logShareEvent: function(a, b, c) {
                TGS.Debug.Log(TGS.Debug.LOG_WARNING, "TGS.Analytics.logShareEvent is deprecated and should not be called directly"), i("share", a, b, c)
            },
            logLevelEvent: function(a, b, c, d) {
                d = d || {}, d.level = b;
                var e;
                ("complete" == a || "fail" == a && null !== c) && (e = c), i("level", a, e, d)
            },
            logAchievementEvent: a("achievement"),
            logCustomEvent: a("custom"),
            _logErrorEvent: a("error"),
            _logClickThruEvent: a("clickthru"),
            _logMoreGamesEvent: a("moregames"),
            _logChallengeEvent: function(a, b) {
                i("challenge", a, null, b)
            },
            _logAdEvent: function(a, b, c) {
                c = c || {}, c.level = b, i("ads", a, null, c)
            }
        }
    }(),
    function() {
        TGS.Analytics.BaseAnalyticsProvider = function() {}, TGS.Analytics.BaseAnalyticsProvider.prototype = {
            name: "Base Provider",
            configName: "BaseProvider",
            init: function() {},
            trackEvent: function() {},
            trackScreen: function() {},
            trackPurchase: function() {}
        }
    }(),
    function() {
        TGS.Analytics.GameAnalyticsProvider = function() {}, TGS.Analytics.GameAnalyticsProvider.prototype = {
            name: "GameAnalytics",
            configName: "GameAnalytics",
            init: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GameAnalyticsProvider.init called: " + JSON.stringify(a)), this._mConfig = a;
                var b = [TGS._sGameVersion, "web"];
                TGS._sConfig.PROD_ENV || b.push("sandbox"), this._mBuild = b.join(" "), this._mSessionId = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(a) {
                    var b = 16 * Math.random() | 0,
                        c = "x" == a ? b : 3 & b | 8;
                    return c.toString(16)
                })
            },
            _apiCall: function(a, b) {
                var c = this._mConfig.GAME_KEY,
                    d = this._mConfig.SECRET_KEY;
                b = b || "design";
                var e = ("https:" == location.protocol ? "https" : "http") + "://api-eu.gameanalytics.com/1/" + c + "/" + b,
                    f = JSON.stringify(a),
                    g = CryptoJS.MD5(f + d),
                    h = CryptoJS.enc.Hex.stringify(g);
                TGS.CORSRequest(e, f, !1, !0, function() {}, function() {}, {
                    Authorization: h
                })
            },
            trackEvent: function(a, b, c) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GameAnalyticsProvider.trackEvent called: " + JSON.stringify(arguments));
                var d = {
                    event_id: a + ":" + b,
                    user_id: TGS._sUserID,
                    session_id: this._mSessionId,
                    build: this._mBuild,
                    value: c
                };
                this._apiCall(d)
            },
            trackScreen: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GameAnalyticsProvider.trackPageView called: " + JSON.stringify(arguments)), this.trackEvent("screen", a)
            },
            trackPurchase: function(a) {
                var b = {
                    event_id: a.item.title,
                    user_id: TGS._sUserID,
                    session_id: this._mSessionId,
                    build: this._mBuild,
                    value: a.item.id,
                    currency: "USD",
                    amount: parseFloat(TGS.Microtransactions.PriceAsUSD(a.item.price))
                };
                this._apiCall(b, "business")
            }
        }, extend(TGS.Analytics.GameAnalyticsProvider, TGS.Analytics.BaseAnalyticsProvider)
    }(),
    function() {
        TGS.Analytics.GoogleAnalyticsProvider = function() {}, TGS.Analytics.GoogleAnalyticsProvider.prototype = {
            name: "Google Analytics",
            configName: "GoogleAnalytics",
            init: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GoogleAnalyticsProvider.init called: " + JSON.stringify(a)), this._mConfig = a, this._mConfig.STUDIO_ONLY || (_gaTreSensa("create", TGS._sConfig.PROD_ENV ? "UA-29301358-4" : "UA-53157750-2", "auto", {
                    name: "TGSTracker"
                }), _gaTreSensa("TGSTracker.require", "displayfeatures"), _gaTreSensa("TGSTracker.set", {
                    dimension1: TGS._sPartnerID,
                    dimension2: TGS._sGameVersion,
                    dimension3: TGS._sGameID
                }), TGS.MicrotransactionsSupported() && _gaTreSensa("TGSTracker.require", "ecommerce", "ecommerce.js"), _gaTreSensa("TGSTracker.send", "pageview")), this._mConfig.STUDIO_ID && "" !== this._mConfig.STUDIO_ID && (_gaTreSensa("create", GameConfig.GoogleAnalytics.STUDIO_ID, "auto", {
                    name: "TGSStudioTracker"
                }), _gaTreSensa("TGSStudioTracker.require", "displayfeatures"), _gaTreSensa("TGSStudioTracker.set", {
                    location: TGS._sConfig.HOST + "/index.html",
                    hostname: TGS._sConfig.HOST,
                    page: TGS._sConfig.PATH,
                    title: this._mConfig.LABEL || TGS._sGameID,
                    referrer: "http://games.tresensa.com",
                    dimension1: TGS._sGameID,
                    dimension2: TGS._sGameVersion
                }), this._studioTrackerEnabled = !0, _gaTreSensa("TGSStudioTracker.send", "pageview"));
                var b = "false" !== (getQueryString().dsttracker || "true").toLowerCase();
                b && !this._mConfig.STUDIO_ONLY && TGS._sConfig.PROD_ENV && TGS._sPartnerBridge._GoogleAnalyticsId && (_gaTreSensa("create", TGS._sPartnerBridge._GoogleAnalyticsId, "auto", {
                    name: "TGSPartnerTracker"
                }), _gaTreSensa("TGSPartnerTracker.require", "displayfeatures"), _gaTreSensa("TGSPartnerTracker.set", {
                    dimension1: TGS._sGameID,
                    dimension2: TGS._sGameVersion
                }), this._partnerTrackerEnabled = !0, _gaTreSensa("TGSPartnerTracker.send", "pageview"))
            },
            trackEvent: function(a, b, c, d) {
                d = d || {};
                var e = d.settings || {},
                    f = {};
                e = e[this.configName] || {}, e.nonInteraction && (f.nonInteraction = !0), ("level" == a || "ad" == a) && d.level > 0 && (b += " - level " + d.level), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GoogleAnalyticsProvider.trackEvent called: " + JSON.stringify(arguments)), this._mConfig.STUDIO_ONLY || "ads" == a || "achievement" == a || "custom" == a || "game" == a && "resume" == b || _gaTreSensa("TGSTracker.send", "event", a, b, this._mConfig.LABEL || TGS._sGameID, c, f), "moregames" == a && (b = "URL launched"), this._studioTrackerEnabled && !e._tresensaOnly && _gaTreSensa("TGSStudioTracker.send", "event", a, b, this._mConfig.LABEL || TGS._sGameID, c, f), this._partnerTrackerEnabled && !e._tresensaOnly && "ads" != a && "achievement" != a && "custom" != a && _gaTreSensa("TGSPartnerTracker.send", "event", a, b, this._mConfig.LABEL || TGS._sGameID, c, f)
            },
            trackScreen: function(a, b) {
                b = b || {};
                var c = b.settings || {};
                c = c[this.configName] || {}, TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GoogleAnalyticsProvider.trackPageView called: " + JSON.stringify(arguments)), this._mConfig.STUDIO_ONLY || "leaderboard" != a || _gaTreSensa("TGSTracker.send", "pageview", TGS._sConfig.PATH + a), this._studioTrackerEnabled && !c._tresensaOnly && _gaTreSensa("TGSStudioTracker.send", "pageview", TGS._sConfig.PATH + a), this._partnerTrackerEnabled && !c._tresensaOnly && "leaderboard" == a && _gaTreSensa("TGSPartnerTracker.send", "pageview", TGS._sConfig.PATH + a)
            },
            trackPurchase: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "GoogleAnalyticsProvider.trackPurchase called: " + JSON.stringify(arguments));
                var b = {
                        id: a.transactionID,
                        affiliation: TGS.Microtransactions.PaymentProviderName(),
                        revenue: TGS.Microtransactions.PriceAsUSD(a.item.price)
                    },
                    c = {
                        id: a.transactionID,
                        name: a.item.title,
                        sku: a.item.id,
                        price: TGS.Microtransactions.PriceAsUSD(a.item.price),
                        quantity: "1",
                        category: TGS.Microtransactions.GetIAPProduct(a.item.id).consumable ? "consumable" : "non-consumable"
                    };
                this._mConfig.STUDIO_ONLY || (_gaTreSensa("TGSTracker.ecommerce:addTransaction", b), _gaTreSensa("TGSTracker.ecommerce:addItem", c), _gaTreSensa("TGSTracker.ecommerce:send"))
            }
        }, extend(TGS.Analytics.GoogleAnalyticsProvider, TGS.Analytics.BaseAnalyticsProvider)
    }(),
    function() {
        ! function(a, b) {
            if (!b.__SV) {
                var c, d, e, f;
                window.mixpanel = b, b._i = [], b.init = function(a, c, d) {
                    function g(a, b) {
                        var c = b.split(".");
                        2 == c.length && (a = a[c[0]], b = c[1]), a[b] = function() {
                            a.push([b].concat(Array.prototype.slice.call(arguments, 0)))
                        }
                    }
                    var h = b;
                    for ("undefined" != typeof d ? h = b[d] = [] : d = "mixpanel", h.people = h.people || [], h.toString = function(a) {
                        var b = "mixpanel";
                        return "mixpanel" !== d && (b += "." + d), a || (b += " (stub)"), b
                    }, h.people.toString = function() {
                        return h.toString(1) + ".people (stub)"
                    }, e = "disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" "), f = 0; f < e.length; f++) g(h, e[f]);
                    b._i.push([a, c, d])
                }, b.__SV = 1.2, c = a.createElement("script"), c.type = "text/javascript", c.async = !0, c.src = "//cdn.mxpnl.com/libs/mixpanel-2.2.min.js", d = a.getElementsByTagName("script")[0], d.parentNode.insertBefore(c, d)
            }
        }(document, window.mixpanel || []), TGS.Analytics.MixPanelProvider = function() {}, TGS.Analytics.MixPanelProvider.prototype = {
            name: "MixPanel",
            configName: "MixPanel",
            init: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "MixPanelProvider.init called: " + JSON.stringify(a)), this._mConfig = a, mixpanel.init(this._mConfig.TOKEN), mixpanel.identify(TGS._sUserID), mixpanel.register_once({
                    "Acquisition Source": TGS._sPartnerID
                }), mixpanel.register({
                    version: TGS._sGameVersion,
                    dst: TGS._sPartnerID,
                    gid: TGS._sGameID,
                    sandbox: !TGS._sConfig.PROD_ENV
                })
            },
            updateUserData: function(a) {
                mixpanel.identify(TGS._sUserID);
                var b = {
                    name: a.name,
                    first_name: a.first_name,
                    last_name: a.last_name,
                    link: a.link,
                    gender: a.gender,
                    locale: a.locale
                };
                a.age_range && (b.age_range = a.age_range.min + " - " + a.age_range.max), mixpanel.people.set(b)
            },
            trackEvent: function(a, b, c, d) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "MixPanelProvider.trackEvent called: " + JSON.stringify(arguments)), d = d || {};
                var e, f = {
                    category: a,
                    value: c
                };
                e = "game" == a || "level" == a ? a + " " + b : "custom" == a ? b : a, "achievement" == a ? f["achievement name"] = b : "error" == a ? f["error message"] = b : "share" == a ? f["share service"] = b : "challenge" == a ? f["challenge event"] = b : "moregames" == a || "clickthru" == a ? f["clickthru url"] = b : "ads" == a && (f.placement = b);
                var g = d.settings;
                delete d.settings, mixpanel.track(e, merge(f, d)), d.settings = g
            },
            trackScreen: function(a, b) {
                b = b || {}, TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "MixPanelProvider.trackPageView called: " + JSON.stringify(arguments)), delete b.settings, mixpanel.track("screen", merge({
                    category: "screen",
                    "screen name": a
                }, b))
            },
            trackPurchase: function(a) {
                mixpanel.people.track_charge(parseFloat(TGS.Microtransactions.PriceAsUSD(a.item.price)), {
                    item_title: a.item.title,
                    item_id: a.item.id,
                    item_category: TGS.Microtransactions.GetIAPProduct(a.item.id).consumable ? "consumable" : "non-consumable",
                    transaction_id: a.transactionID
                })
            }
        }, extend(TGS.Analytics.MixPanelProvider, TGS.Analytics.BaseAnalyticsProvider)
    }(),
    function() {
        TGS.Analytics.NativeGoogleAnalyticsProvider = function() {}, TGS.Analytics.NativeGoogleAnalyticsProvider.prototype = {
            name: "Native Google Analytics",
            configName: "GoogleAnalytics",
            init: function(a) {
                if (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeGoogleAnalyticsProvider.init called: " + JSON.stringify(a)), this._mConfig = a, this._gaPlugin = window.plugins.gaPlugin, !a.NATIVE_ID) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "CordovaConfig.GoogleAnalytics.NATIVE_ID not set, disabling analytics"), !1;
                window.plugins && window.plugins.gaPlugin || TGS.Debug.Log(TGS.Debug.LOG_ERROR, "PhoneGap GoogleAnalytics plugin was not found, disabling analytics");
                var b, c, d;
                this._mConfig.STUDIO_ONLY || (b = TGS._sConfig.PROD_ENV ? "UA-29301358-4" : "UA-53157750-2"), this._mConfig.STUDIO_ID && "" !== this._mConfig.STUDIO_ID && (c = GameConfig.GoogleAnalytics.STUDIO_ID, this._studioTrackerEnabled = !0);
                var e = "false" !== (getQueryString().dsttracker || "true").toLowerCase();
                e && !this._mConfig.STUDIO_ONLY && TGS._sConfig.PROD_ENV && TGS._sPartnerBridge._GoogleAnalyticsId && (d = TGS._sPartnerBridge._GoogleAnalyticsId, this._partnerTrackerEnabled = !0);
                var f = this;
                this._gaPlugin.init(function() {
                    f._gaPlugin.setVariable(null, null, "tgs", 1, TGS._sPartnerID), f._gaPlugin.setVariable(null, null, "tgs", 2, TGS._sGameVersion), f._gaPlugin.setVariable(null, null, "tgs", 3, TGS._sGameID), f._gaPlugin.setVariable(null, null, "studio", 1, TGS._sGameID), f._gaPlugin.setVariable(null, null, "studio", 2, TGS._sGameVersion), f._gaPlugin.setVariable(null, null, "partner", 1, TGS._sGameID), f._gaPlugin.setVariable(null, null, "partner", 2, TGS._sGameVersion)
                }, this._logError, b, c, d, 10)
            },
            trackEvent: function(a, b, c, d) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeGoogleAnalyticsProvider.trackEvent called: " + JSON.stringify(arguments)), d = d || {};
                var e = d.settings || {};
                e = e[this.configName] || {}, ("level" == a || "ad" == a) && d.level > 0 && (b += " - level " + d.level), "number" != typeof c && (c = -1), this._mConfig.STUDIO_ONLY || "ads" == a || "achievement" == a || "custom" == a || "game" == a && "resume" == b || this._gaPlugin.trackEvent(this._logResult, this._logError, "tgs", a, b, this._mConfig.LABEL || TGS._sGameID, c), "moregames" == a && (b = "URL launched"), this._studioTrackerEnabled && !e._tresensaOnly && this._gaPlugin.trackEvent(this._logResult, this._logError, "studio", a, b, this._mConfig.LABEL || TGS._sGameID, c), this._partnerTrackerEnabled && !e._tresensaOnly && "ads" != a && "achievement" != a && "custom" != a && this._gaPlugin.trackEvent(this._logResult, this._logError, "partner", a, b, this._mConfig.LABEL || TGS._sGameID, c)
            },
            trackScreen: function(a, b) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeGoogleAnalyticsProvider.trackPageView called: " + JSON.stringify(arguments)), b = b || {};
                var c = b.settings || {};
                c = c[this.configName] || {}, this._mConfig.STUDIO_ONLY || "leaderboard" != a || this._gaPlugin.trackPage(this._logResult, this._logError, "tgs", a), this._studioTrackerEnabled && !c._tresensaOnly && this._gaPlugin.trackPage(this._logResult, this._logError, "studio", a), this._partnerTrackerEnabled && !c._tresensaOnly && "leaderboard" == a && this._gaPlugin.trackPage(this._logResult, this._logError, "partner", a)
            },
            trackPurchase: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeGoogleAnalyticsProvider.trackPurchase called: " + JSON.stringify(arguments)), this._mConfig.STUDIO_ONLY || this._gaPlugin.trackPurchase(this._logResult, this._logError, "tgs", a.transactionID, TGS.Microtransactions.PaymentProviderName(), a.item.id, a.item.title, TGS.Microtransactions.PriceAsUSD(a.item.price), 1, TGS.Microtransactions.GetIAPProduct(a.item.id).consumable ? "consumable" : "non-consumable")
            },
            _logError: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_ERROR, "NativeGoogleAnalyticsProvider - " + a)
            },
            _logResult: function(a) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeGoogleAnalyticsProvider - " + a)
            }
        }, extend(TGS.Analytics.GoogleAnalyticsProvider, TGS.Analytics.BaseAnalyticsProvider)
    }(),
    function() {
        TGS.Analytics.NativeMixPanelProvider = function() {}, TGS.Analytics.NativeMixPanelProvider.prototype = {
            name: "MixPanel",
            configName: "MixPanel",
            init: function(a) {
                return TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeMixPanelProvider.init called: " + JSON.stringify(a)), this._mConfig = a, window.plugins && window.plugins.mixpanel ? (this._mpPlugin = window.plugins.mixpanel, this._mpPlugin.sharedInstanceWithToken(this._mConfig.TOKEN), void this._mpPlugin.identify(TGS._sUserID)) : (TGS.Debug.Log(TGS.Debug.LOG_ERROR, "PhoneGap MixPanel plugin was not found, disabling analytics"), !1)
            },
            updateUserData: function(a) {
                mixpanel.identify(TGS._sUserID);
                var b = {
                    name: a.name,
                    first_name: a.first_name,
                    last_name: a.last_name,
                    link: a.link,
                    gender: a.gender,
                    locale: a.locale
                };
                a.age_range && (b.age_range = a.age_range.min + " - " + a.age_range.max), mixpanel.people.set(b)
            },
            trackEvent: function(a, b, c, d) {
                TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeMixPanelProvider.trackEvent called: " + JSON.stringify(arguments)), d = d || {};
                var e, f = {
                    category: a,
                    value: c,
                    "Acquisition Source": TGS._sPartnerID,
                    version: TGS._sGameVersion,
                    dst: TGS._sPartnerID,
                    gid: TGS._sGameID,
                    sandbox: !TGS._sConfig.PROD_ENV
                };
                e = "game" == a || "level" == a ? a + " " + b : "custom" == a ? b : a, "achievement" == a ? f["achievement name"] = b : "error" == a ? f["error message"] = b : "share" == a ? f["share service"] = b : "challenge" == a ? f["challenge event"] = b : "moregames" == a || "clickthru" == a ? f["clickthru url"] = b : "ads" == a && (f.placement = b);
                var g = d.settings;
                delete d.settings, this._mpPlugin.track(e, merge(f, d)), d.settings = g
            },
            trackScreen: function(a, b) {
                b = b || {}, TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "NativeMixPanelProvider.trackPageView called: " + JSON.stringify(arguments)), delete b.settings, this._mpPlugin.track("screen", merge({
                    category: "screen",
                    "screen name": a,
                    "Acquisition Source": TGS._sPartnerID,
                    version: TGS._sGameVersion,
                    dst: TGS._sPartnerID,
                    gid: TGS._sGameID,
                    sandbox: !TGS._sConfig.PROD_ENV
                }, b))
            },
            trackPurchase: function(a) {
                this._mpPlugin.trackCharge(parseFloat(TGS.Microtransactions.PriceAsUSD(a.item.price)), {
                    item_title: a.item.title,
                    item_id: a.item.id,
                    transaction_id: a.transactionID,
                    item_category: TGS.Microtransactions.GetIAPProduct(a.item.id).consumable ? "consumable" : "non-consumable",
                    "Acquisition Source": TGS._sPartnerID,
                    version: TGS._sGameVersion,
                    dst: TGS._sPartnerID,
                    gid: TGS._sGameID,
                    sandbox: !TGS._sConfig.PROD_ENV
                })
            }
        }, extend(TGS.Analytics.NativeMixPanelProvider, TGS.Analytics.BaseAnalyticsProvider)
    }(),
    function() {
        TGS.Social = {
            ChallengeIcon: function() {
                return TGS._sPartnerBridge.challengeIcon()
            },
            Challenge: function(a) {
                TGS._sPartnerBridge.challenge(a)
            },
            Share: function(a, b) {
                b = b || {};
                var c;
                c = b.url ? b.url : TGS.BrowserDetect.usingPhoneGap ? TGS._sConfig.HOST : window.self != window.top ? document.referrer : window.location.href, TGS._sPartnerBridge.share(a, {
                    title: b.title || TGS._sConfig.TITLE,
                    msg: b.msg || "I am playing " + TGS._sConfig.TITLE,
                    url: c,
                    image: b.image || TGS._sConfig.HOST + "/banners/256x160.png"
                });
                var d = TGS.Social._services[a];
                TGS.Analytics._logShareEvent(d && d.analyticsId || a)
            },
            GetShareServices: function(a) {
                var b = TGS._sPartnerBridge.getShareServices();
                return a && b.length > a && (b.length = a), b
            },
            _services: {
                twitter: {
                    id: "",
                    title: "",
                    label: ""
                },
                fb: {
                    id: "",
                    title: "",
                    label: "",
                    analyticsId: ""
                }
            }
        }
    }(),
    function() {
        var a = function(a, b, c, d) {
                var e = document.createElement("div");
                //if (e.classList.add("tgs-btn"), c)
                   // for (var f = c.split(" "), g = f.length - 1; g >= 0; g--) e.classList.add(f[g]);
                var h = "",
                    i = !1;
                return ("login" == c || "logout" == c) && (i = "login" == d ? TGS.LoggedIn() ? TGS.LogoutIcon() : TGS.LoginIcon() : TGS.LoggedIn() ? TGS.WidgetLogoutIcon() : TGS.WidgetLoginIcon()), i && (h += "<img src='" + i + "'/>"), h += "<span>" + a + "</span>", e.innerHTML = h, b && e.addEventListener(TGS.BrowserDetect.clickEvent, b), e
            },
            b = function() {
                return {
                    scale: TGE.Game.GetInstance().stage._mScale
                }
            };
        TGS.Widget = function(c) {
            c = c || {}, this.opts = c, this.pos = {
                top: c.y || 0,
                left: c.x || 0
            }, this.size = {
                width: c.width || 300,
                height: 0
            }, this.closeCallback = c.closeCallback, this.element = document.createElement("div"), this.element.id = "tgs-widget", this.element.style.top = this.pos.top + "px", this.element.style.left = this.pos.left + "px", this.element.style.width = this.size.width + "px", this.element.style.height = this.size.height ? this.size.height + "px" : "auto";
            var d, e = this;
            this.updatePlacement = function() {
                var a = 1,
                    b = d();
                "number" == typeof b ? a = b : (a = b.scale ? b.scale : a, e.pos.top = "number" == typeof b.y ? b.y : e.pos.top, e.pos.left = "number" == typeof b.x ? b.x : e.pos.left), e.element.style.top = e.pos.top + "px", e.element.style.left = e.pos.left + "px", e.element.style.webkitTransform = "scale(" + a + ")", e.element.style.MozTransform = "scale(" + a + ")", e.element.style.msTransform = "scale(" + a + ")", e.element.style.OTransform = "scale(" + a + ")", e.element.style.transform = "scale(" + a + ")"
            }, c.placementFunc ? d = c.placementFunc : c.scalingFunc ? d = c.scalingFunc : TGS.Utils.isTGEGame() && TGE.Game.GetInstance()._mDivResized && (d = b), d && (this.element.style.webkitTransformOrigin = "top left", this.element.style.MozTransformOrigin = "top left", this.element.style.msTransformOrigin = "top left", this.element.style.OTransformOrigin = "top left", this.element.style.transformOrigin = "top left", window.addEventListener("resize", this.updatePlacement), this.updatePlacement());
            var f = c.disableAd ? 0 : 300,
                g = c.disableAd ? 0 : 10,
                h = c.minColumnWidth || 130,
                i = this.size.width >= f + g + h,
                j = this.size.width - f - g,
                k = c.columnPaddingPercent || 2,
                l = j * k / 100;
            c.widgetClass && this.element.classList.add(c.widgetClass), i && this.element.classList.add("horizontal");
            var m = 1;
            if (c.disableAd && this.size.width >= 4 * h + 3 * l ? (this.element.classList.add("four-column"), m = 4) : (!i || c.disableAd) && this.size.width >= h + l + h && (this.element.classList.add("two-column"), m = 2), !c.disableAd && TGS._sPartnerBridge._mDisplayAdsEnabled && (this.ad = new TGS.Advertisement({}), this.ad.widgetOpts = this.opts, this.ad._inject(this.element), this.ad.element && (this.ad.element.style.position = "static"), TGS.Analytics._logAdEvent("display")), this.buttonContainer = document.createElement("div"), this.buttonContainer.classList.add("btn-container"), i && (this.buttonContainer.style.width = j + "px"), c.showLogin) {
                var n = TGS.GetLoginButtonText();
                if (n && ("Restore Purchases" != n || !c.disableRestore)) {
                    var o = TGS.GetLoginButtonAction(function() {
                            if (p && p.parentNode) {
                                var b = TGS.GetLoginButtonText();
                                if (b) {
                                    var d = a(b, o, b.toLowerCase().replace(/ /g, "-"), c.widgetClass);
                                    e.buttonContainer.insertBefore(d, p)
                                }
                                p.parentNode.removeChild(p), p = d, v()
                            }
                        }),
                        p = a(n, o, n.toLowerCase().replace(/ /g, "-"), c.widgetClass);
                    this.buttonContainer.appendChild(p)
                }
            }
            if (!c.disableShare)
                for (var q = TGS.Social.GetShareServices(2), r = 0; r < q.length; r++) {
                    var s = q[r],
                        t = {
                            title: c[s.id] && c[s.id].shareTitle || c.shareTitle,
                            msg: c[s.id] && c[s.id].shareMessage || c.shareMessage,
                            url: c[s.id] && c[s.id].shareUrl || c.shareUrl,
                            image: c[s.id] && c[s.id].shareImageUrl || c.shareImageUrl
                        };
                    this.buttonContainer.appendChild(a(s.label, TGS.Social.Share.bind(null, s.id, t), s.id))
                }
            if (!c.disableMoreGames && TGS.MoreGamesURL() && this.buttonContainer.appendChild(a(TGS._sPartnerBridge._mMoreGamesText, TGS.ShowMoreGames, "moregames")), !c.disableLeaderboard && TGS.Leaderboard.isSupported() && Object.keys(TGS.Leaderboard.GetLeaderboardDescriptors()).length > 0)
                if (void 0 === c.leaderboardID) TGS.Debug.Log(TGS.Debug.LOG_WARNING, "Widget leaderboard button enabled, but not leaderboardID specified... Button will not show.");
                else {
                    var u = TGS.Leaderboard.Show.bind(this, {
                        leaderboardID: c.leaderboardID,
                        timePeriod: c.leaderboardTimePeriod || "week",
                        page: 1,
                        gameCanvas: c.parentDiv,
                        cssUrl: c.cssUrl
                    });
                    this.buttonContainer.appendChild(a(TGS.Leaderboard.getLabel(c.leaderboardID), u, "leaderboard"))
                }
            var v = function() {
                if (m > 1) {
                    e.buttonContainer.style.marginBottom = -k + "%";
                    for (var a = e.buttonContainer.childNodes, b = a.length - 1; b >= 0; b--) {
                        var c = b == a.length - 1;
                        a[b].style.marginBottom = k + "%", 2 == m && a.length % 2 != 0 && c ? a[b].style.width = "100%" : ((4 == m && !c || b % 2 === 0) && (a[b].style.marginRight = k + "%"), a[b].style.width = (100 - (m - 1) * k) / m + "%")
                    }
                }
            };
            v(), this.element.appendChild(this.buttonContainer)
        }, TGS.Widget.prototype = {
            appendTo: function(a) {
                return a.insertBefore(this.element, a.firstChild), this
            },
            close: function(a) {
                this.ad && this.ad.close(), this.element && this.element.parentNode && this.element.parentNode.removeChild(this.element), window.removeEventListener("resize", this.updatePlacement);
                var b = this.closeCallback,
                    c = function() {
                        b && b(this), a && a(this)
                    };
                return this.opts.disableInterstitialAd ? c() : TGS.Advertisement.DisplayInterstitialAd({
                    closeCallback: c,
                    parentDiv: this.opts.parentDiv
                }), this
            }
        }, TGS.Widget.CreateWidget = function(a) {
            var b;
            a = a || {}, a.disableMoreGames = !1, b = TGS.Utils.isTGEGame() ? a.parentDiv || TGE.Game.GameDiv() : a.parentDiv || document.body, a.parentDiv = b;
            var c = new TGS.Widget(a);
            return c.appendTo(b)
        }, TGS.Widget.CreateLoginWidget = function(a) {
            var b;
            a = a || {}, a.disableAd = !0, a.disableInterstitialAd = !0, a.disableLeaderboard = !0, a.disableShare = !0, a.disableMoreGames = !0, a.showLogin = !0, a.width = a.width || 200, a.widgetClass = "login", b = TGS.Utils.isTGEGame() ? a.parentDiv || TGE.Game.GameDiv() : a.parentDiv || document.body;
            var c = new TGS.Widget(a);
            return c.appendTo(b)
        }
    }(),
    function() {
        var a = (navigator.language || navigator.userLanguage || "en").split("-")[0],
            b = getQueryString().lang;
        TGS.Language = {
            SupportedLanguages: ["en"],
            PreferredLanguage: function() {
                if (!TGS.IsReady()) throw "TGS not ready";
                var c = b || TGS._sPartnerBridge.preferredLanguage() || a;
                return -1 != TGS.Language.SupportedLanguages.indexOf(c) ? c : TGS.Language.SupportedLanguages[0] || "en"
            }
        }
    }(),
    function() {
        TGS.Adapters = {}, 
			TGS._SERVER_LOCATION = ("https:" === document.location.protocol ? "https:" : "http:") + "//tgs.tresensa.com/server/0.3.9/", 
			TGS._IMAGES_LOCATION = ("https:" === document.location.protocol ? "https:" : "http:") + "./4399/tgs/images/", TGS._sOn = !1, TGS._sFakeConnections = !1, TGS._sPartnerID = null, TGS._sGameID = null, TGS._sUserID = null, TGS._sPartnerBridge = null, TGS._sGamePartnerInfo = null, TGS._sLSKeys = {}, TGS._sOnline = !0, TGS._sMessageOverlay = null, TGS._env = window.GameConfig && window.GameConfig.PROD_ENV ? "production" : "sandbox", TGS.OverlayRed = .6, TGS.OverlayGreen = .6, TGS.OverlayBlue = .6, TGS.OverlayOpacity = .6, TGS.onReady = null;
        var a = {};
        TGS.Debug = TGS.Debug || {}, TGS.Debug.LOG_NONE = 0, TGS.Debug.LOG_ERROR = 1, TGS.Debug.LOG_WARNING = 2, TGS.Debug.LOG_INFO = 3, TGS.Debug.LOG_VERBOSE = 4, TGS.Debug.LogLevel = "undefined" != typeof GameConfig && "number" == typeof GameConfig.LOG_LEVEL ? GameConfig.LOG_LEVEL : TGS.Debug.LOG_INFO, TGS.Debug.Log = function(a) {
            if (window.console && a <= TGS.Debug.LogLevel) {
                var b = "TGS: ",
                    c = "log";
                a === TGS.Debug.LOG_ERROR ? (b += "**ERROR** ", c = "error") : a === TGS.Debug.LOG_WARNING && (b += "**WARNING** ", c = "warn"), window.console[c](b + Array.prototype.slice.call(arguments, 1))
            }
        }, TGS.UseServer = function(a) {
            TGS._SERVER_LOCATION = ("https:" === document.location.protocol ? "https:" : "http:") + "//" + a
        }, TGS.localStorage = window.localStorage, TGS._TestLocalStorage = function() {
            TGS.localStorage = window.localStorage;
            try {
                localStorage.setItem("storage", ""), localStorage.removeItem("storage")
            } catch (a) {
                TGS.Debug.Log(TGS.Debug.LOG_WARNING, "localStorage is not supported");
                var b = {};
                TGS.localStorage = {
                    setItem: function(a, c) {
                        b[a] = c
                    },
                    removeItem: function(a) {
                        delete b[a]
                    },
                    getItem: function(a) {
                        return b[a]
                    }
                }
            }
        }, TGS.IsOn = function() {
            return TGS._sOn
        }, TGS.IsReady = function() {
            return TGS._sPartnerID && TGS._sGameID && TGS._sPartnerBridge && (!TGS._sPartnerBridge.supportsDatastore() || TGS._sUserID && TGS.DataStore.GameData) ? TGS._sPartnerBridge.isReady() : !1
        }, TGS.MicrotransactionsSupported = function() {
            return TGS._sPartnerBridge.supportsMicrotransactions() && TGS._sPartnerBridge.supportsDatastore()
        }, TGS.MicrotransactionsAllowed = function() {
            return TGS._sPartnerBridge.allowsMicrotransactions()
        }, TGS.DatastoreSupported = function() {
            return TGS._sPartnerBridge.supportsDatastore()
        }, TGS.LeaderboardSupported = function() {
            return TGS.Leaderboard.isSupported()
        }, TGS.AutoLogin = function() {
            return TGS._sPartnerBridge.autoLogin()
        }, TGS.LoginIcon = function() {
            return TGS._sPartnerBridge.loginIcon()
        }, TGS.LogoutIcon = function() {
            return TGS._sPartnerBridge.logoutIcon()
        }, TGS.WidgetLoginIcon = function() {
            return TGS._sPartnerBridge.widgetLoginIcon()
        }, TGS.WidgetLogoutIcon = function() {
            return TGS._sPartnerBridge.widgetLogoutIcon()
        }, TGS.ChallengesSupported = function() {
            return TGS._sPartnerBridge.supportsChallenges()
        }, TGS.LoggedIn = function() {
            return TGS._sPartnerBridge.loggedIn()
        }, TGS.LoginUser = function(a) {
            a = "undefined" == typeof a ? {} : a, TGS._sLoginOverlay = TGS.LoadingOverlay();
            var b = new TGS.LoginRequest;
            b.onSuccess = a.onSuccess, b.onFailure = a.onFailure, b.onUserCancel = a.onUserCancel, TGS._sPartnerBridge.loginUser(b)
        }, TGS.LogoutUser = function(a) {
            a = "undefined" == typeof a ? {} : a, TGS._sLoginOverlay = TGS.LoadingOverlay();
            var b = new TGS.LoginRequest;
            b.onSuccess = a.onSuccess, b.onFailure = a.onFailure, b.onUserCancel = a.onUserCancel, TGS._sPartnerBridge.logoutUser(b)
        }, TGS.ToggleUserLogin = function(a) {
            TGS.AutoLogin() || (TGS.LoggedIn() ? TGS.LogoutUser(a) : TGS.LoginUser(a))
        }, TGS._LoginSucceeded = function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "user login/logout process was successful"), a && a.onSuccess && a.onSuccess.call(), TGS._sLoginOverlay && (TGS._sLoginOverlay.parentNode.removeChild(TGS._sLoginOverlay), TGS._sLoginOverlay = null), window.TGE && TGE.Game.GetInstance() && TGE.Game.GetInstance().stage.dispatchEvent({
                type: "tgs_login_changed"
            }), TGS.Analytics.logGameEvent(TGS.LoggedIn() ? "login success" : "logout")
        }, TGS._LoginFailed = function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_ERROR, "there was an error during the login/logout process"), a && a.onFailure && a.onFailure.call(), TGS._sLoginOverlay && (TGS._sLoginOverlay.parentNode.removeChild(TGS._sLoginOverlay), TGS._sLoginOverlay = null), TGS.Analytics.logGameEvent("login failure")
        }, TGS._LoginCanceled = function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "user cancelled login"), a.onUserCancel && a.onUserCancel.call(), TGS._sLoginOverlay && (TGS._sLoginOverlay.parentNode.removeChild(TGS._sLoginOverlay), TGS._sLoginOverlay = null), TGS.Analytics.logGameEvent("login cancel")
        }, TGS.GetDateTime = function(a, b) {
            var c = null;
            return TGS.IsReady() || (c = "Tried to request the server date/time before TGS was ready"), a || (c = "Date/time request was made without specifying a success callback"), null !== c ? void(b ? b.call(this, c, null) : TGS.Debug.Log(TGS.Debug.LOG_ERROR, c)) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "requesting date/time from the server..."), void TGS.SendMessage("time", "get", null, TGS._GetDateTimeCallback.bind(this, a), b))
        }, TGS._GetDateTimeCallback = function(a, b) {
            a.call(this, new Date(b.time))
        }, TGS.GameLaunched = function() {
            if (TGS._sPartnerBridge) {
                if (TGS._sPartnerBridge.autoUnlockNonConsumables)
                    for (var a = TGS.Microtransactions.GetIAPProducts(), b = 0; b < a.length; b++) {
                        var c = a[b];
                        c.consumable || (TGS.Debug.Log(TGS.Debug.LOG_INFO, 'Automatically unlocking item "' + c.id + '"...'), TGS.Microtransactions._RestorePurchaseCallback(c.id))
                    }
                TGS._sPartnerBridge.gameWasLaunched()
            }
        }, TGS.EnablePartnerUI = function(a) {
            null !== TGS._sPartnerBridge && TGS._sPartnerBridge.enablePartnerUI(a)
        }, TGS.GenericSuccessCallback = function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "	server request was successful"), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "	response obj: " + JSON.stringify(a))
        }, TGS.GenericErrorCallback = function(a, b) {
            TGS.Debug.Log(TGS.Debug.LOG_WARNING, "	GenericErrorCallback " + a), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "	GenericErrorCallback response obj: " + JSON.stringify(b))
        }, TGS.SendMessage = function(a, b, c, d, e) {
            if (!TGS._sOnline) return void(e && e("TGS is offline"));
            d = d ? d : TGS.GenericSuccessCallback, e = e ? e : TGS.GenericErrorCallback;
            var f = [TGS._SERVER_LOCATION, a, ".php", "?gid=", TGS._sGameID, "&tgs=", window.GameConfig ? GameConfig.TGS.VERSION : "unknown", "&dst=", TGS._sPartnerID, "&env=", TGS._env].join(""),
                g = "string" == typeof b ? "type=" + b + "&" : "",
                h = g + "data=" + c;
            TGS.CORSRequest(f, h, !0, !0, d, e)
        }, TGS.CORSRequest = function(a, b, c, d, e, f, g, h, i) {
            var j = null;
            h = h || "POST";
            var k = null,
                l = !1;
            g = g || {
                "Content-type": "application/x-www-form-urlencoded"
            };
            var m = function(a, b) {
                    b = b || {};
                    for (var c in b) b.hasOwnProperty(c) && a.setRequestHeader(c, b[c])
                },
                n = function(a, b) {
                    b = b || {};
                    for (var c in b) b.hasOwnProperty(c) && (a[c] = b[c])
                };
            try {
                if (window.XMLHttpRequest) {
                    if ("GET" === h && (a = a + (-1 === a.indexOf("?") ? "?" : "&") + b, b = null), j = new XMLHttpRequest, "withCredentials" in j) j.open(h, a, !0), m(j, g), n(j, i), j.send(b);
                    else if ("undefined" != typeof XDomainRequest) {
                        l = !0, j = new XDomainRequest;
                        var o = Math.floor(99999999999 * Math.random());
                        a = a + (-1 === a.indexOf("?") ? "?" : "&") + "cb=" + o, j.open(h, a), m(j, g), n(j, i), j.send()
                    }
                } else j = new ActiveXObject("Microsoft.XMLHTTP"), j.open(h, a, !0), m(j, g), n(j, i), j.send(b)
            } catch (p) {
                f && f("server failed to respond", p)
            }
            try {
                l ? (j.timeout = 1e4, j.onerror = function() {}, j.ontimeout = function() {}, j.onprogress = function() {}, j.onload = function() {
                    if (!d) return void e(j.responseText);
                    try {
                        k = JSON.parse(j.responseText)
                    } catch (a) {
                        TGS.Debug.Log(TGS.Debug.LOG_WARNING, "server response could not be parsed: " + j.responseText), k = null
                    }
                    if (k) {
                        if (c && 0 !== k.code && f) {
                            var b = "the TGS server returned error code " + k.code;
                            return "string" == typeof k.message && (b += " " + k.message), TGS.Debug.Log(TGS.Debug.LOG_WARNING, b), void f(b, k)
                        }
                        e(k)
                    } else f && (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "server request returned bad data"), f("server request returned bad data", null))
                }) : j.onreadystatechange = function() {
                    if (4 == j.readyState)
                        if (200 != j.status) f && (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "the page returned error code " + j.status + " message: " + j.statusText), f("the page returned error code " + j.status, j));
                        else {
                            if (!d) return void e(j.responseText);
                            try {
                                k = JSON.parse(j.responseText)
                            } catch (a) {
                                TGS.Debug.Log(TGS.Debug.LOG_WARNING, "server response could not be parsed: " + j.responseText), k = null
                            }
                            if (k) {
                                if (c && 0 !== k.code && f) {
                                    var b = "the TGS server returned error code " + k.code;
                                    return "string" == typeof k.message && (b += " " + k.message), TGS.Debug.Log(TGS.Debug.LOG_WARNING, b), void f(b, k)
                                }
                                e(k)
                            } else f && (TGS.Debug.Log(TGS.Debug.LOG_WARNING, "server request returned bad data"), f("server request returned bad data", null))
                        }
                }
            } catch (q) {
                f && f("server error", q)
            }
        }, TGS.Init = function(a, b) {
            if (1 == arguments.length ? (TGS._sConfig = a, a = TGS._sConfig.GAME_ID, b = TGS._sConfig.DST_ID) : (window.GameConfig.DST_ID = TGL.getDistributionPartner(), TGS._sConfig = window.GameConfig), TGS._TestLocalStorage(), "string" != typeof a || a.length < 1) return void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "a valid game id was not specified");
            TGS._sGameID = a;
            var c = this._sConfig.VERSION || "none";
            TGS._sGameVersion = c, "string" != typeof b || b.length < 1 ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "no partner id specified - using generic adapter"), TGS._sPartnerID = "0000") : TGS._sPartnerID = b, TGS._sOn = !0;
            var d = "_" + TGS._sPartnerID + "_" + TGS._sGameID;
            "sandbox" == TGS._env && (d += "_sandbox"), TGS._sLSKeys.TGS_datastore = "TGS_datastore" + d, TGS._sLSKeys.TGS_userid = "TGS_userid" + d, TGS._sLSKeys.TGS_loggedin_user = "TGS_loggedin_user" + d, TGS._sLSKeys.TGS_username = "TGS_username" + d, TGS._sLSKeys.TGS_avatar = "TGS_avatar" + d, TGS._sLSKeys.TGS_location = "TGS_location" + d, TGS._sLSKeys.TGS_gameinfo = "TGS_gameinfo" + d, TGS._sLSKeys.TGS_pending_score = "TGS_pending_score" + d, "undefined" == typeof TGS.AdapterDefinitions && TGS.Debug.Log(TGS.Debug.LOG_INFO, "the TGS adapter definitions library was not loaded, only the generic adapter and Q0000 will be available"), TGS._injectCSS(), TGS._LoadAdapterLibraries()
        };
        var b;
        TGS.PromptToBookmark = function() {
            b && addToHomescreen.isCompatible && TGS._sPartnerBridge._mShowBookmarkPrompt && b.show()
        }, TGS._injectCSS = function() {
            var a = window.TGL ? TGL.SDKBaseURL + "tgs/" : "//sdk.tresensa.com/tgs/",
                b = document.getElementsByTagName("head")[0],
                c = document.createElement("link"),
                d = TGS.version.split(".");
            d.length = 2, c.type = "text/css", c.href = a + "css/tgs-" + d.join(".") + ".css", c.rel = "stylesheet", c.media = "screen", b.appendChild(c)
        }, TGS._LoadAdapterLibraries = function() {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "loading partner adapter and 3rd party libs...");
            var a = TGS.AdapterDefinitions ? TGS.AdapterDefinitions[TGS._sPartnerID] : null,
                b = [],
                c = window.TGL ? TGL.SDKBaseURL + "tgs/" : "//sdk.tresensa.com/tgs/",
                d = window.TGL ? TGL.MinifiedSuffix : ".min";
            a && (a.embedded !== !0 && b.push(c + TGS._sPartnerID + "/" + TGS._sPartnerID + "-" + a.version + d + ".js"), "https:" === document.location.protocol && a.httpslibs ? b = b.concat(a.httpslibs) : a.libs && (b = b.concat(a.libs))), a && a.fb !== !0 || b.push(("https:" === document.location.protocol ? "https:" : "http:") + ""), "undefined" != typeof head && b.length > 0 ? (head.js.apply(this, b), head.ready(TGS._CreatePartnerBridge)) : TGS._CreatePartnerBridge()
        }, TGS._CreatePartnerBridge = function() {
            if (TGS.Adapters[TGS._sPartnerID]) try {
                TGS.Debug.Log(TGS.Debug.LOG_INFO, "creating " + TGS._sPartnerID + " adapter..."), TGS._sPartnerBridge = new TGS.Adapters[TGS._sPartnerID]
            } catch (a) {
                return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "error instantiating partner adapter"), void TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "   (" + a + ")")
            } else TGS.Debug.Log(TGS.Debug.LOG_INFO, "creating generic adapter..."), TGS._sPartnerBridge = new TGS.Adapters.GenericAdapter;
            TGS._sPartnerBridge._mFacebookServicesAllowed = "undefined" != typeof FB, TGS._sPartnerBridge.onAdapterReady = TGS.onPartnerBridgeReady, TGS._sPartnerBridge.onUserInfoAvailable = TGS.onUserInfoAvailable, TGS._sPartnerBridge.masterInitialize(), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "requesting game-partner info from server..."), TGS._sPartnerBridge.requestGameInfo(TGS._sGameID)
        }, TGS.onGamePartnerInfoReceived = function(a) {
            return TGS.Debug.Log(TGS.Debug.LOG_INFO, "game-partner info received"), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "game-partner info: " + JSON.stringify(a)), a && "undefined" != typeof a.code ? 0 !== a.code ? void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "game-partner info contained error code: " + a.code) : (TGS._sGamePartnerInfo = a.partner_values, TGS.Microtransactions._sIAPProducts = a.iap_products, TGS.Microtransactions._sAppURLs = a.app_urls, TGS.Leaderboard._sLeaderboardDescriptors = a.leaderboards, TGS.localStorage.setItem(TGS._sLSKeys.TGS_gameinfo, JSON.stringify(a)), TGS.Advertisement.SetupEngagementTrackers(a.partner_values.tracking_urls, a.partner_values.engagement_time), void(TGS._sPartnerBridge.isReady() ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "initiating connection to partner..."), TGS._sPartnerBridge.masterConnect(TGS._sGamePartnerInfo)) : TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "partner bridge not ready yet"))) : void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "game-partner info was corrupt")
        }, TGS.onGamePartnerInfoError = function(a, b) {
            TGS.Debug.Log(TGS.Debug.LOG_ERROR, "could not retrieve game-partner info: " + a), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "	response obj: " + JSON.stringify(b));
            var c = TGS.localStorage.getItem(TGS._sLSKeys.TGS_gameinfo);
            c ? (TGS.Debug.Log(TGS.Debug.LOG_INFO, "using a local copy of the game-partner info"), b = JSON.parse(c), TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "game-partner info: " + JSON.stringify(b)), TGS._sGamePartnerInfo = b.partner_values, TGS.Microtransactions._sIAPProducts = b.iap_products, TGS.Microtransactions._sAppURLs = b.app_urls, TGS.Leaderboard._sLeaderboardDescriptors = b.leaderboards) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "no local copy of the game-partner info is available"), TGS.OverlayMessage({
                title: "Oops!",
                message: "Could not retrieve game info from the server. Some game features like in-app purchase and leaderboards may not be available."
            }), TGS._sGamePartnerInfo = {}, TGS.Microtransactions._sIAPProducts = [], TGS.Microtransactions._sAppURLs = [], TGS.Leaderboard._sLeaderboardDescriptors = []), TGS._sPartnerBridge.masterConnect(TGS._sGamePartnerInfo)
        }, TGS.onPartnerBridgeReady = function() {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "partner bridge is ready"), null !== TGS._sGamePartnerInfo && (TGS.Debug.Log(TGS.Debug.LOG_INFO, "connecting to partner..."), TGS._sPartnerBridge.masterConnect(TGS._sGamePartnerInfo))
        }, TGS.onUserInfoAvailable = function(a) {
            return a ? (TGS._sUserID = a.toString(), TGS.Debug.Log(TGS.Debug.LOG_INFO, "user id is: " + TGS._sUserID), void TGS.DataStore.ReloadGameData(TGS.onGameDataReceivedForUser)) : void TGS.Debug.Log(TGS.Debug.LOG_INFO, "invalid user id")
        }, TGS.onGameDataReceivedForUser = function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "received game info for user " + JSON.stringify(a)), TGS.MakeTGSReady()
        }, TGS.addEventListener = function(b, c) {
            a[b] = a[b] || [], a[b].push(c)
        }, TGS.removeEventListener = function(b, c) {
            if (c) {
                if (a[b]) {
                    var d = a[b].indexOf(c); - 1 !== d && a[b].splice(d, 1)
                }
            } else a[b] = []
        }, TGS.dispatchEvent = function(b, c) {
            if (a[b])
                for (var d = 0; d < a[b].length; d++) {
                    var e = a[b][d];
                    try {
                        e.call(null, c)
                    } catch (f) {
                        TGS.Debug.Log(TGS.Debug.LOG_ERROR, "Error while dispatching event [" + b + "]: " + f)
                    }
                }
        }, TGS.MakeTGSReady = function() {
            if (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "MakeTGSReady called"), TGS.IsReady()) {
                if (TGS._sPartnerBridge._mShowBookmarkPrompt && (b = addToHomescreen({
                    autostart: !1,
                    detectHomescreen: "hash",
                    maxDisplayCount: 0,
                    displayPace: 0,
                    skipFirstVisit: !0,
                    startDelay: 0,
                    onAdd: function() {
                        TGS.Debug.Log(TGS.Debug.LOG_INFO, "Add to homescreen detected. Triggering 'bookmarked' event"), TGS.Analytics.logGameEvent("bookmarked"), setTimeout(function() {
                            TGS.dispatchEvent("bookmarked")
                        }, 0)
                    }
                }), TGS.PromptToBookmark()), TGS._DisplaySplashScreen({
                    closeCallback: function() {
                        GameConfig.ADS.PRELOADER_PLACEMENT_ID && TGS.Advertisement._DisplayPreloaderAd({
                            parentDiv: document.body
                        })
                    }
                }), window.TGE) {
                    var a = TGE.Game.GetInstance();
                    a && a._onTGSReady && a._onTGSReady()
                }
                "function" == typeof TGS.onReady && (TGS.Debug.Log(TGS.Debug.LOG_VERBOSE, "Calling TGS.onReady"), TGS.onReady.call(this)), TGS.dispatchEvent("ready")
            }
        }, TGS.AddRequiredImagesToAssetList = function(a) {
            if (!window.TGE) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "you must be using the TreSensa TGE library to use TGS.AddRequiredImagesToAssetList"), null;
            var b = TGE.Game.GetInstance();
            null !== TGS.LoginIcon() && b.assetManager.addAsset(a, {
                id: "tgs_login_icon",
                url: TGS.LoginIcon(),
                absolutePath: !0
            }), null !== TGS.LogoutIcon() && b.assetManager.addAsset(a, {
                id: "tgs_logout_icon",
                url: TGS.LogoutIcon(),
                absolutePath: !0
            }), null !== TGS.Microtransactions.CurrencyIcon() && b.assetManager.addAsset(a, {
                id: "tgs_currency_icon",
                url: TGS.Microtransactions.CurrencyIcon(),
                absolutePath: !0
            }), TGS.MoreGamesURL() && null !== TGS._sPartnerBridge._mMoreGamesImage && b.assetManager.addAsset(a, {
                id: "tgs_more_games",
                url: TGS._sPartnerBridge._mMoreGamesImage,
                absolutePath: !0
            }), null !== TGS.Social.ChallengeIcon() && b.assetManager.addAsset(a, {
                id: "tgs_challenge_icon",
                url: TGS.Social.ChallengeIcon(),
                absolutePath: !0
            })
        }, TGS.GetLoginButtonText = function() {
            return "A0001" !== TGS._sPartnerID && "A0002" !== TGS._sPartnerID && "A0030" !== TGS._sPartnerID || !TGS.Microtransactions.HasNonConsumables() ? TGS.AutoLogin() || !TGS._sPartnerBridge.supportsLogout() && TGS.LoggedIn() || !TGS.LoginIcon() ? void 0 : TGS.LoggedIn() ? "Logout" : "Login" : "Restore Purchases"
        }, TGS.GetLoginButtonAction = function(a) {
            return "A0001" !== TGS._sPartnerID && "A0002" !== TGS._sPartnerID && "A0030" !== TGS._sPartnerID || !TGS.Microtransactions.HasNonConsumables() ? TGS.AutoLogin() || !TGS._sPartnerBridge.supportsLogout() && TGS.LoggedIn() || !TGS.LoginIcon() ? void 0 : TGS.ToggleUserLogin.bind(TGS, {
                onSuccess: a
            }) : TGS.Microtransactions.RestorePurchases.bind(TGS.Microtransactions)
        }, TGS.CreateLoginWidget = function(a) {
            if (!window.TGE) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "you must be using the TreSensa TGE library to use TGS.CreateLoginWidget"), null;
            var b = new TGE.DisplayObjectContainer;
            if ("A0001" !== TGS._sPartnerID && "A0002" !== TGS._sPartnerID && "A0030" !== TGS._sPartnerID || !TGS.Microtransactions.HasNonConsumables())
                if (TGS.AutoLogin() || !TGS._sPartnerBridge.supportsLogout() && TGS.LoggedIn() || !TGS.LoginIcon());
                else {
                    var c = (new TGE.Button).setup({
                        image: TGS.LoggedIn() ? "tgs_logout_icon" : "tgs_login_icon",
                        pressFunction: TGS.ToggleUserLogin.bind(null, a)
                    });
                    c.addEventListener("tgs_login_changed", function(a) {
                        var b = a.currentTarget,
                            c = TGS.LoggedIn() ? "tgs_logout_icon" : "tgs_login_icon";
                        !TGS._sPartnerBridge.supportsLogout() && TGS.LoggedIn() && (b.enabled = !1, b.visible = !1, c = null), b.setImage(c)
                    }), b.addChild(c)
                } else b.addChild((new TGE.Button).setup({
                image: "tgs_login_icon",
                pressFunction: TGS.Microtransactions.RestorePurchases
            }));
            return b
        }, TGS.CreateMoreGamesButton = function(a) {
            if (!window.TGE) return TGS.Debug.Log(TGS.Debug.LOG_ERROR, "you must be using the TreSensa TGE library to use TGS.CreateMoreGamesButton"), null;
            var b = new TGE.DisplayObjectContainer;
            if (TGS.MoreGamesURL()) {
                var c = (new TGE.Button).setup({
                        image: "tgs_more_games",
                        pressFunction: TGS.ShowMoreGames
                    }),
                    d = 0,
                    e = 0,
                    f = 1,
                    g = TGE.Game.GetInstance().stage; - 1 !== a.indexOf("top") && (e = 40), -1 !== a.indexOf("bottom") && (e = g.height - 40, f = -1), -1 !== a.indexOf("left") && (d = 140), -1 !== a.indexOf("right") && (d = g.width - 140), -1 !== a.indexOf("center") && (d = g.width / 2, e -= 19 * f), b.x = d, b.y = e, b.addChild(c)
            }
            return b
        }, TGS.MoreGamesURL = function() {
            return window.GameConfig && GameConfig.MoreGames && GameConfig.MoreGames.ENABLED ? GameConfig.MoreGames.URL : TGS._sPartnerBridge._mMoreGamesURL
        }, TGS.ShowMoreGames = function() {
            TGS._sPartnerBridge.showMoreGames()
        }, TGS._DisplaySplashScreen = function(a) {
            a = a || {}, TGS._sPartnerBridge.showSplashScreen(a)
        }, TGS.OverlayMessage = function(a) {
            if (!a || !a.message) return void TGS.Debug.Log(TGS.Debug.LOG_ERROR, "no message specified in TGS.OverlayMessage call");
            null !== TGS._sMessageOverlay && TGS.CloseMessageOverlay();
            var b = TGS.BrowserDetect.onAndroid && parseInt(TGS.BrowserDetect.OSversion.charAt(0)) < 4,
                c = TGS.BrowserDetect.isMobileDevice ? window.TGE && TGE.Game.GetInstance() ? 1.2 * TGE.Game.GetInstance()._mViewportScale : .6 : 1,
                d = 1;
            b && (d = c, c = 1);
            var e = "undefined" == typeof a.overlayRed ? TGS.OverlayRed : a.overlayRed,
                f = "undefined" == typeof a.overlayGreen ? TGS.OverlayGreen : a.overlayGreen,
                g = "undefined" == typeof a.overlayBlue ? TGS.OverlayBlue : a.overlayBlue,
                h = "undefined" == typeof a.overlayOpacity ? TGS.OverlayOpacity : a.overlayOpacity,
                i = "string" != typeof a.buttonText ? "OK" : a.buttonText,
                j = "undefined" == typeof a.buttonAction ? null : a.buttonAction,
                k = "undefined" == typeof a.buttonSize ? 1 : a.buttonSize,
                l = document.createElement("div");
            l.id = "overlay", l.style.zIndex = 10, l.style.position = "fixed", l.style.width = "100%", l.style.height = "100%", l.style.top = 0, l.style.left = 0, l.style.backgroundColor = "rgba(" + Math.round(255 * e).toString() + "," + Math.round(255 * f).toString() + "," + Math.round(255 * g).toString() + "," + h.toString() + ")", document.body.firstChild ? document.body.insertBefore(l, document.body.firstChild) : document.body.appendChild(l), TGS._sMessageOverlay = l;
            var m = 300 * d,
                n = 0 * d,
                o = 20 * d,
                p = document.createElement("div");
            p.id = "box", p.style.position = "absolute";
            var q = window.innerWidth / 2 - (m + 2 * o + 2 * n) * c / 2;
            p.style.left = q.toString() + "px", p.style.width = m + "px", p.style.marginLeft = "auto", p.style.marginRight = "auto", p.style.textAlign = "left", p.style.padding = o + "px", p.style.backgroundColor = "#fff", p.style.borderRadius = "5px", p.style.boxShadow = "0px 0px 20px 4px #222", l.insertBefore(p, l.firstChild);
            var r = null,
                s = null,
                t = null;
            if (r = document.createElement("img"), r.id = "close", r.src = TGS._IMAGES_LOCATION + "close-button.png", r.style.position = "absolute", r.style.top = "-" + o + "px", r.style.left = m + "px", r.style.padding = "10px", r.style.cursor = "pointer", p.insertBefore(r, p.firstChild), "" !== i && (s = document.createElement("div"), s.id = "button", s.style.width = Math.round(.4 * m * k * d) + "px", s.style.textAlign = "center", s.style.padding = Math.round(10 * k) + "px", s.style.backgroundColor = "#ef2e24", s.style.color = "#fff", s.style.fontSize = Math.round(20 * k * d) + "px", s.style.fontWeight = "bold", s.innerHTML = i, s.style.cursor = "pointer", p.insertBefore(s, p.firstChild)), a.button2Image) {
                var u = 15,
                    v = document.createElement("div");
                v.style.marginLeft = "auto", v.style.marginRight = "auto", v.style.textAlign = "center", v.style.width = "100%", v.style.height = 90 + 2 * u + "px", v.backgroundColor = "#f00", p.insertBefore(v, p.firstChild), t = document.createElement("img"), t.id = "button2", t.src = a.button2Image, t.style.marginLeft = "auto", t.style.marginRight = "auto", t.style.textAlign = "center", t.style.padding = Math.round(u * d) + "px", t.height = Math.round(90 * d), t.width = Math.round(256 * d), t.style.cursor = "pointer", v.insertBefore(t, v.firstChild)
            } else a.button2Text && (t = document.createElement("div"), t.id = "button2", t.style.width = Math.round(.4 * m * k * d) + "px", t.style.textAlign = "center", t.style.padding = Math.round(10 * k) + "px", t.style.marginBottom = "15px", t.style.backgroundColor = "#ef2e24", t.style.color = "#fff", t.style.fontSize = Math.round(20 * k * d) + "px", t.style.fontWeight = "bold", t.innerHTML = a.button2Text, t.style.cursor = "pointer", p.insertBefore(t, p.firstChild));
            var w = document.createElement("div");
            if (w.id = "text", w.style.textAlign = "left", w.style.color = "#000", w.style.fontSize = Math.round(18 * d) + "px", w.style.paddingBottom = o + "px", w.innerHTML = a.message, p.insertBefore(w, p.firstChild), a.title) {
                var x = document.createElement("div");
                x.id = "title", x.style.textAlign = "left", x.style.color = "#000", x.style.fontSize = Math.round(26 * ((1 + d) / 2)) + "px", x.style.fontWeight = "bold", x.style.paddingBottom = "10px", x.innerHTML = a.title, p.insertBefore(x, p.firstChild)
            }
            var y = Math.min(window.innerHeight, window.GameConfig && "landscape" === GameConfig.ORIENTATION ? 536 : 832) / 2 - p.clientHeight * c / 2;
            p.style.top = y.toString() + "px";
            var z = TGS.BrowserDetect.isMobileDevice && "Windows Phone" !== TGS.BrowserDetect.platform ? "touchstart" : "click";
            if (null !== s && s.addEventListener(z, TGS.CloseMessageOverlay.bind(this, j), !1), null !== r && r.addEventListener(z, TGS.CloseMessageOverlay.bind(this, j), !1), null !== t && t.addEventListener(z, a.button2Callback, !1), l.addEventListener("click", TGS._BlockEvent, !1), l.addEventListener("mousedown", TGS._BlockEvent, !1), l.addEventListener("mouseup", TGS._BlockEvent, !1), l.addEventListener("mousemove", TGS._BlockEvent, !1), l.addEventListener("touchstart", TGS._BlockEvent, !1), !b) {
                var A = p.getAttribute("style") || "";
                p.setAttribute("style", A + " -ms-transform-origin: 0% 0%; -webkit-transform-origin: 0% 0%; -moz-transform-origin: 0% 0%; -o-transform-origin: 0% 0%; transform-origin: 0% 0%; -ms-transform: scale(" + c + "); -webkit-transform: scale(" + c + "); -moz-transform: scale(" + c + "); -o-transform: scale(" + c + "); transform: scale(" + c + ");")
            }
        }, TGS.CloseMessageOverlay = function(a) {
            null !== TGS._sMessageOverlay && (TGS._sMessageOverlay.parentNode && TGS._sMessageOverlay.parentNode.removeChild(TGS._sMessageOverlay), TGS._sMessageOverlay = null, a && a.call())
        }, TGS.OpenURL = function(a, b, c, d) {
            TGS._sPartnerBridge.openURL(a, b, c), d !== !0 && TGS.Analytics._logClickThruEvent(a, null, d)
        }, TGS.LoadingOverlay = function() {
            var a = TGS.OverlayRed,
                b = TGS.OverlayGreen,
                c = TGS.OverlayBlue,
                d = TGS.OverlayOpacity,
                e = document.createElement("div");
            e.id = "overlay", e.style.zIndex = 9, e.style.position = "fixed", e.style.width = "100%", e.style.height = "100%", e.style.top = 0, e.style.left = 0, e.style.backgroundColor = "rgba(" + Math.round(255 * a).toString() + "," + Math.round(255 * b).toString() + "," + Math.round(255 * c).toString() + "," + d.toString() + ")", document.body.firstChild ? document.body.insertBefore(e, document.body.firstChild) : document.body.appendChild(e);
            var f = document.createElement("img");
            f.id = "gif", f.src = TGS._IMAGES_LOCATION + "processing.gif";
            var g = .45 * window.innerHeight;
            return f.style.display = "block", f.style.marginLeft = "auto", f.style.marginRight = "auto", f.style.marginTop = g.toString() + "px", f.style.align = "center", e.insertBefore(f, e.firstChild), e.addEventListener("click", TGS._BlockEvent, !1), e.addEventListener("mousedown", TGS._BlockEvent, !1), e.addEventListener("mouseup", TGS._BlockEvent, !1), e.addEventListener("mousemove", TGS._BlockEvent, !1), e.addEventListener("touchstart", TGS._BlockEvent, !1), e
        }, TGS._BlockEvent = function(a) {
            return a.stopPropagation(), a.preventDefault(), a.stopImmediatePropagation && a.stopImmediatePropagation(), !1
        }, TGS.noop = function() {}, TGS.LoginRequest = function() {
            this.onSuccess = null, this.onFailure = null, this.onUserCancel = null
        }
    }(), TGS.Adapters.GenericAdapter = function() {
        TGS.Adapters.GenericAdapter.superclass.constructor.call(this), TGS.DataStore._sSaveToLocalStorage = !0, TGS.DataStore._sSaveToTGSServer = !1, this._mMoreGamesURL = "http://www.mobilewebarcade.com/"
    }, TGS.Adapters.GenericAdapter.prototype = {}, extend(TGS.Adapters.GenericAdapter, TGS.PartnerBridge), TGS.Adapters.Q0000 = function() {
        TGS.Adapters.Q0000.superclass.constructor.call(this), this._mLoggedIn = !1, this._mMoreGamesURL = "http://www.mobilewebarcade.com/", "false" === getQueryString().fb && (this._mFacebookServicesAllowed = !1, this._mUseUserInfoInSLB = !0), TGS.DataStore._sSaveToLocalStorage = !0, TGS.DataStore._sSaveToTGSServer = !1, this._GoogleAnalyticsId = "UA-53157750-1", this._mShowBookmarkPrompt = !0
    }, TGS.Adapters.Q0000.prototype = {
        supportsMicrotransactions: function() {
            return !0
        },
        autoLogin: function() {
            return !1
        },
        costFactor: function() {
            return 10
        },
        priceAsFormattedString: function(a) {
            return "$" + (a * this.costFactor() / 100 - .01).toFixed(2)
        },
        currencyIcon: function() {
            return TGS._IMAGES_LOCATION + "testicon.png"
        },
        connect: function() {
            this.getLoginStatus()
        },
        loginUser: function(a) {
            TGS.Debug.Log(TGS.Debug.LOG_INFO, "prompting user to login...");
            var b = window.prompt("LOGIN (enter your username):", "");
            return b ? "string" != typeof b || b.length < 1 ? void TGS._LoginFailed(a) : (this._mUsername = b, void this.userLoggedIn(a, b)) : void TGS._LoginCanceled(a)
        },
        purchaseItem: function(a) {
            a.partnerTransactionID = ~~(2147483648 * Math.random()), setTimeout(this.openPurchase.bind(this, a), 2e3)
        },
        openPurchase: function(a) {
            var b = "Do you agree to pay " + this.priceAsFormattedString(a.item.price) + " to buy " + a.item.title + "?",
                c = confirm(b);
            setTimeout(this.closePurchase.bind(this, c, a), 1e3)
        },
        closePurchase: function(a, b) {
            a ? window.GameConfig && GameConfig.PROD_ENV === !0 ? (b.internalErrorMessage = "PROD_ENV=true", b.userErrorMessage = "IAP purchases are not allowed in production.", TGS.Microtransactions._PartnerPurchaseFailed(b)) : (TGS.Debug.Log(TGS.Debug.LOG_INFO, "TestAdapter approved purchase of transaction " + b.transactionID), TGS.Microtransactions._PartnerPurchaseSuccessful(b)) : (b.internalErrorMessage = "user cancelled", b.userErrorMessage = "", TGS.Microtransactions._PartnerPurchaseFailed(b))
        }
    }, extend(TGS.Adapters.Q0000, TGS.PartnerBridge);
TGS.version = '0.3.32';